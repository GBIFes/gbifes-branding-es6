{"version":3,"sources":["app/js/collectory.js","app/js/css-loader.js","app/js/i18n_init.js","app/js/i18n_menus.js","app/js/init.js","app/js/jquery-eu-cookie-law-popup.js","app/js/jquery.i18n.properties.js","app/js/sentry.js","app/js/settings.js","app/js/stats.js","app/js/top-search.js"],"names":["addCollectoryDownloadsLegend","setTimeout","test","window","location","host","$","length","console","log","after","document","addEventListener","Url","require","Cookies","gbifesjs","default","getUsersPreferredLanguages","navigator","languages","undefined","language","parseLanguages","acceptedLangs","defaultLang","userPref","match","find","indexOf","lang","locale","gbiflocale","currentUrl","enabledLangs","i18n_init","isDevel","query","get","isValid","set","expires","path","domain","in30Minutes","search","endsWith","str","suffix","i18n_menus","each","$this","_href","attr","uri","split","hash","url","href","i","curlang","$link","localeUrl","replace","index","currentItem","text","toLowerCase","removeClass","addClass","layoutUrl","jQuery","i18n","warn","properties","name","mode","debug","encoding","cache","async","callback","keys","trans","prop","elementID","substring","html","euCookieLawPopup","init","cookiePolicyUrl","popupPosition","colorStyle","compactStyle","popupTitle","popupText","buttonContinueTitle","buttonLearnmoreTitle","buttonLearnmoreOpenInNewWindow","agreementExpiresInDays","autoAcceptCookiePolicy","htmlMarkup","checkExist","setInterval","clearInterval","fn","_self","params","vars","INITIALISED","HTML_MARKUP","COOKIE_NAME","parseParameters","object","markup","settings","className","createHtmlMarkup","setUserAcceptsCookies","consent","d","Date","expiresInDays","setTime","getTime","toGMTString","cookie","trigger","userAlreadyAcceptedCookies","userAcceptedCookies","cookies","c","trim","hideContainer","animate","opacity","height","hide","publicfunc","first","append","on","show","ready","event","map","message","defaults","namespace","extend","normaliseLanguageCode","files","constructor","Array","totalFiles","filesLoaded","forEach","file","defaultFileName","shortFileName","longFileName","fileNames","shortCode","longCode","loadAndParseFiles","key","args","slice","call","arguments","phvList","isArray","replacements","splice","prototype","push","apply","value","charAt","arr","j","parseInt","isNaN","s","callbackIfComplete","loadAndParseFile","shift","filename","nextFile","ajax","dataType","success","data","status","parseData","error","jqXHR","textStatus","errorThrown","parsed","lines","regPlaceHolder","regRepPlaceHolder","unicodeRE","line","pair","decodeURI","trimRight","unicodeMatches","unescapeUnicode","checkKeyNamespace","parts","fnArgs","usedArgs","part","fnExpr","eval","regDot","fullname","names","userLanguage","toUpperCase","codes","code","substr","Math","pow","reduce","acc","val","String","fromCharCode","Sentry","dsn","sentryUrl","onload","ajaxError","ajaxSettings","thrownError","Raven","captureMessage","statusText","extra","type","response","responseText","loadStats","getJSON","addPeriods","totalRecords","count","nStr","sep","x","x1","x2","rgx","enableBieSearch"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,4BAAT,GAAwC;AACtCC,aAAW,YAAM;AACjB,QAAI,uBAAuBC,IAAvB,CAA4BC,OAAOC,QAAP,CAAgBC,IAA5C,CAAJ,EAAuD;AACrD,UAAIC,EAAE,kBAAF,EAAsBC,MAAtB,KAAiC,CAArC,EAAwC;AACtCC,gBAAQC,GAAR,CAAY,sCAAZ;AACAH,UAAE,qBAAF,EAAyBI,KAAzB,CAA+B,mLAA/B;AACA;AACD;AACF;AACF,GARC,EAQC,IARD;AASD;;AAEDC,SAASC,gBAAT,CAA0B,kBAA1B,EAA6C,YAAU;AACrDZ;AACD,CAFD;;AAKA;;;;ACjBA;;;;;;;;;;;;;;;;;ACAA,IAAIa,MAAMC,QAAQ,QAAR,CAAV;AACA,IAAIC,UAAUD,QAAQ,WAAR,CAAd;AACA,IAAIE,WAAWF,QAAQ,YAAR,EAAsBG,OAArC;;AAEA;AACA;AACA;;AAEA,SAASC,0BAAT,GAAsC;AACpC,MAAIC,UAAUC,SAAV,KAAwBC,SAA5B,EAAuC;AACrC,WAAOF,UAAUC,SAAjB;AACD,GAFD,MAEO,IAAID,UAAUG,QAAV,KAAuBD,SAA3B,EAAsC;AAC3C,WAAO,CAACF,UAAUG,QAAX,CAAP;AACD,GAFM,MAEA;AACL,WAAOD,SAAP;AACD,GAPmC,CAOlC;AACH;;AAED,SAASE,cAAT,CAAwBC,aAAxB,EAA4D;AAAA,MAArBC,WAAqB,uEAAP,KAAO;;AAC1D,MAAMC,WAAWR,4BAAjB;AACA,MAAMS,QAAQD,WAAWA,SAASE,IAAT,CAAc;AAAA,WAAQJ,cAAcK,OAAd,CAAsBC,IAAtB,MAAgC,CAAC,CAAzC;AAAA,GAAd,CAAX,GAAuET,SAArF;AACA,MAAIM,UAAUN,SAAV,IAAuBI,gBAAgB,KAA3C,EAAmD;AACjD,WAAOA,WAAP;AACD;AACD,SAAOE,KAAP;AACD;;AAED,IAAII,SAAS5B,OAAO6B,UAApB;;AAEA;AACA,IAAIC,aAAc,IAAIpB,GAAJ,EAAlB;;AAEA,IAAMqB,eAAe,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,CAArB;;AAEA1B,QAAQC,GAAR,kCAA2Cc,eAAeW,YAAf,EAA6B,IAA7B,CAA3C;;AAEA,SAASC,SAAT,GAAqB;AACnB,MAAInB,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,CAAY,2BAAZ;;AAEtB,UAiDOsB,MAjDP,YAASE,WAAWI,KAAX,CAAiBP,IAA1B;;AAEA,MAAId,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,mBAA4BsB,MAA5B;;AAEtB,MAAI,OAAOA,MAAP,KAAkB,WAAtB,EAAmC;AACjC,YA4CKA,MA5CL,YAAShB,QAAQuB,GAAR,CAAY,oBAAZ,CAAT;AACD;;AAED,MAAItB,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,sBAA+BsB,MAA/B;;AAEtB,MAAIA,WAAWV,SAAX,IAAwBU,WAAW,IAAvC,EAA6C;AAC3C,YAsCKA,MAtCL,YAASR,eAAeW,YAAf,EAA6B,IAA7B,CAAT;AACD;;AAED,MAAIlB,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,qBAA8BsB,MAA9B;;AAEtB,MAAMQ,UAAWL,aAAaL,OAAb,CAAqBE,MAArB,IAA+B,CAAC,CAAjD;;AAEA,MAAI,CAACQ,OAAL,EAAc;AACZ,YA8BKR,MA9BL,YAAS,IAAT;AACA,QAAIf,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,8BAAuCsB,MAAvC;AACvB,GAHD,MAGO;AACL,QAAIf,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,mCAA4CsB,MAA5C;AACvB;;AAED,MAAIf,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,kBAA2BsB,MAA3B;;AAEtB;AACAhB,UAAQyB,GAAR,CAAY,oBAAZ,EAAkCT,MAAlC,EAA0C,EAAEU,SAAS,GAAX,EAAgBC,MAAM,GAAtB,EAA1C;AACA;AACA3B,UAAQyB,GAAR,CAAY,oBAAZ,EAAkCT,MAAlC,EAA0C,EAAEU,SAAS,GAAX,EAAgBC,MAAM,GAAtB,EAA2BC,QAAQ,UAAnC,EAA1C;AAED;;AAED,IAAI,OAAOZ,MAAP,KAAkB,WAAtB,EAAmC;AACjC,MAAIf,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,mBAA4BsB,MAA5B;AACtBI;AACD;;AAED,IAAI,OAAOpB,QAAQuB,GAAR,CAAY,4BAAZ,CAAP,KAAqD,WAArD,IAAoE,OAAOL,WAAWI,KAAX,CAAiBP,IAAxB,KAAiC,WAAzG,EAAsH;AACpH;AACA;AACA,MAAIc,cAAc,IAAE,EAApB;AACA;AACA7B,UAAQyB,GAAR,CAAY,4BAAZ,EAA0C,GAA1C,EAA+C,EAAEC,SAASG,WAAX,EAA/C;AACAX,aAAWI,KAAX,CAAiBP,IAAjB,GAAwBC,MAAxB;AACApB,WAASP,QAAT,CAAkByC,MAAlB,GAA2BZ,WAAWI,KAAtC;AACD;;QAEQN,M,GAAAA,M;QAAQG,Y,GAAAA,Y;;;;;;ACxFjB;;;;AAIA,IAAIlB,WAAWF,QAAQ,YAAR,EAAsBG,OAArC;AACAH,QAAQ,8BAAR;;eAC+BA,QAAQ,aAAR,C;IAAzBiB,M,YAAAA,M;IAAQG,Y,YAAAA,Y;;AAEd;AACA;;;AACA,SAASY,QAAT,CAAkBC,GAAlB,EAAuBC,MAAvB,EAA+B;AAC7B,SAAOD,IAAIlB,OAAJ,CAAYmB,MAAZ,EAAoBD,IAAIxC,MAAJ,GAAayC,OAAOzC,MAAxC,MAAoD,CAAC,CAA5D;AACD;;AAED,SAAS0C,UAAT,GAAsB;AACpBzC,UAAQC,GAAR,CAAY,oBAAZ;AACA,MAAIO,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,4BAAqCsB,MAArC;;AAEtB;AACA,MAAIA,MAAJ,EAAY;AACVzB,MAAE,+BAAF,EAAmC4C,IAAnC,CAAwC,YAAY;AAClD,UAAMC,QAAQ7C,EAAE,IAAF,CAAd;AACA,UAAM8C,QAAQD,MAAME,IAAN,CAAW,MAAX,CAAd;AACA;AACA,UAAMC,MAAMF,MAAMG,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAZ;AACA,UAAMC,OAAOJ,MAAMG,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAb;AACA,UAAI,OAAOC,IAAP,KAAgB,WAApB,EAAiC;AAC/B;AACAL,cAAME,IAAN,CAAW,MAAX,EAAsBD,KAAtB,cAAoCrB,MAApC;AACD,OAHD,MAGO;AACLoB,cAAME,IAAN,CAAW,MAAX,EAAsBC,GAAtB,cAAkCvB,MAAlC,SAA4CyB,IAA5C;AACD;AACD,UAAIxC,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,0BAAmC0C,MAAME,IAAN,CAAW,MAAX,CAAnC;AACvB,KAbD;AAcD;;AAED,MAAMI,MAAMtD,OAAOC,QAAP,CAAgBsD,IAA5B;;AAEA,MAAI1C,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,qBAA8ByB,YAA9B;;AAEtB;AACA,OAAK,IAAIyB,IAAI,CAAb,EAAgBA,IAAIzB,aAAa3B,MAAjC,EAAyCoD,GAAzC,EAA8C;AAC5C,QAAMC,UAAU1B,aAAayB,CAAb,CAAhB;AACA,QAAME,QAAQvD,QAAMsD,OAAN,kBAAd,CAF4C,CAEA;;AAE5C,QAAIE,YAAYL,GAAhB;;AAEA,QAAIA,IAAI5B,OAAJ,CAAY,OAAZ,MAAyB,CAAC,CAA9B,EAAiC;AAC/BiC,kBAAYL,IAAIM,OAAJ,CAAY,2BAAZ,YAAiDH,OAAjD,CAAZ;AACD,KAFD,MAEO,IAAIH,IAAI5B,OAAJ,CAAY,GAAZ,MAAqB,CAAC,CAA1B,EAA6B;AAClCiC,kBAAeA,SAAf,cAAiCF,OAAjC;AACD,KAFM,MAEA;AACL,UAAMN,MAAMG,IAAIF,KAAJ,CAAU,GAAV,EAAe,CAAf,CAAZ;AACA,UAAIC,OAAOC,IAAIF,KAAJ,CAAU,GAAV,EAAe,CAAf,CAAX;AACAC,aAAO,OAAOA,IAAP,KAAgB,WAAhB,GAA8B,EAA9B,SAAuCA,IAA9C;AACAM,kBAAeR,GAAf,cAA2BM,OAA3B,GAAqCJ,IAArC;AACD;AACDK,UAAMR,IAAN,CAAW,MAAX,EAAmBS,SAAnB;AACA,QAAI9C,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,0BAAmCoD,MAAMR,IAAN,CAAW,MAAX,CAAnC;AACvB;;AAGD;AACA/C,IAAE,0CAAF,EAA8C4C,IAA9C,CAAmD,UAAUc,KAAV,EAAiB;AAClE,QAAMC,cAAc3D,EAAE,IAAF,EAAQ4D,IAAR,GAAeH,OAAf,CAAuB,aAAvB,EAAsC,EAAtC,EAA0CI,WAA1C,EAApB;AACA7D,MAAE,IAAF,EAAQ8D,WAAR,CAAoB,0BAApB;AACA,QAAIH,gBAAgBlC,MAApB,EAA4B;AAC1BzB,QAAE,IAAF,EAAQ+D,QAAR,CAAiB,0BAAjB;AACD;AACF,GAND;;AAQA,MAAM3B,OAAU1B,SAASsD,SAAnB,UAAN;;AAEA,MAAItD,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,kBAA2BiC,IAA3B;AACtB,MAAI,OAAO6B,OAAOC,IAAd,KAAuB,WAA3B,EAAwChE,QAAQiE,IAAR,CAAa,4BAAb;;AAExC;AACAF,SAAOC,IAAP,CAAYE,UAAZ,CAAuB;AACrBC,UAAM,UADe;AAErBjC,UAAMA,IAFe;AAGrBkC,UAAM,KAHe;AAIrBC,WAAO,KAJc;AAKrBC,cAAU,OALW;AAMrBC,WAAO,KANc;AAOrBzD,cAAUS,MAPW;AAQrBiD,WAAO,IARc;AASrBC,cAAU,oBAAW;AACnB,UAAIjE,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR;AACtB,UAAMyE,OAAO,CACX,kBADW,EAEX,mBAFW,EAGX,mBAHW,EAIX,WAJW,EAKX,kBALW,EAMX,eANW,EAOX,aAPW,EAQX,cARW,EASX,cATW,EAUX,qBAVW,EAWX,mBAXW,EAYX,+BAZW,EAaX,4BAbW,EAcX,uBAdW,EAeX,kBAfW,EAgBX,sBAhBW,EAiBX,sBAjBW,EAkBX,qBAlBW,EAmBX,2BAnBW,EAoBX,wBApBW,EAqBX,4BArBW,EAsBX,uBAtBW,EAuBX,cAvBW,EAwBX,cAxBW,EAyBX,eAzBW,EA0BX,mBA1BW,EA2BX,wBA3BW,EA4BX,wBA5BW,EA6BX,sBA7BW,EA8BX,6BA9BW,EA+BX,mBA/BW,EAgCX,0BAhCW,EAiCX,kBAjCW,EAkCX,yBAlCW,EAmCX,kBAnCW,EAoCX,yBApCW,EAqCX,mBArCW,EAsCX,iCAtCW,EAuCX,+BAvCW,EAwCX,gBAxCW,EAyCX,iBAzCW,EA0CX,iBA1CW,EA2CX,oBA3CW,EA4CX,gCA5CW,CAAb;;AA+CA,WAAK,IAAIvB,KAAI,CAAb,EAAgBA,KAAIuB,KAAK3E,MAAzB,EAAiCoD,IAAjC,EAAsC;AACpC,YAAMwB,QAAQZ,OAAOC,IAAP,CAAYY,IAAZ,CAAiBF,KAAKvB,EAAL,CAAjB,CAAd;AACA,YAAI3C,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,cAAuByE,KAAKvB,EAAL,CAAvB,UAAmCwB,KAAnC;AACtB,YAAI,OAAOA,KAAP,KAAiB,WAArB,EAAkC;AAChC,cAAIrC,SAASoC,KAAKvB,EAAL,CAAT,EAAkB,cAAlB,CAAJ,EAAuC;AACrC,gBAAM0B,YAAYH,KAAKvB,EAAL,EAAQ2B,SAAR,CAAkB,CAAlB,EAAqBJ,KAAKvB,EAAL,EAAQpD,MAAR,GAAiB,EAAtC,CAAlB;AACA;AACAD,oBAAM+E,SAAN,KAAsB/E,QAAM+E,SAAN,EAAmBhC,IAAnB,CAAwB,aAAxB,EAAuC8B,KAAvC,CAAtB;AACD,WAJD,MAIO;AACL;AACA7E,oBAAM4E,KAAKvB,EAAL,CAAN,KAAoBrD,QAAM4E,KAAKvB,EAAL,CAAN,EAAiB4B,IAAjB,CAAsBJ,KAAtB,CAApB;AACD;AACF;AACF;;AAED7E,QAAEK,QAAF,EAAY6E,gBAAZ,GAA+BC,IAA/B,CAAoC;AAClCC,yBAAkB,0CADgB;AAElCC,uBAAgB,QAFkB;AAGlCC,oBAAa,MAHqB;AAIlCC,sBAAe,IAJmB;AAKlCC,oBAAa,EALqB;AAMlCC,mBAAYxB,OAAOC,IAAP,CAAYY,IAAZ,CAAiB,gBAAjB,CANsB;AAOlCY,6BAAsBzB,OAAOC,IAAP,CAAYY,IAAZ,CAAiB,mBAAjB,CAPY;AAQlCa,8BAAsB1B,OAAOC,IAAP,CAAYY,IAAZ,CAAiB,mBAAjB,CARY;AASlCc,wCAAiC,IATC;AAUlCC,gCAAyB,EAVS;AAWlCC,gCAAyB,KAXS;AAYlCC,oBAAa;AAZqB,OAApC;AAcD;AAvFoB,GAAvB;AAyFD;;AAED;AACA;;;;AAIA/F,EAAE,YAAW;AACX;AACA,MAAIgG,aAAaC,YAAY,YAAW;AACtC,QAAIjG,EAAE,YAAF,EAAgBC,MAApB,EAA4B;AAC1BC,cAAQC,GAAR,CAAY,yBAAZ;AACA+F,oBAAcF,UAAd;AACArD;AACD,KAJD,MAIO;AACL,UAAIjC,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,CAAY,6BAAZ;AACvB;AACF,GARgB,EAQd,IARc,CAAjB;AASD,CAXD;;;;;;AC7KAK,QAAQ,eAAR,EAAyBG,OAAzB;AACAH,QAAQ,gBAAR;AACAA,QAAQ,iBAAR;AACAA,QAAQ,iBAAR;AACAA,QAAQ,aAAR;AACAA,QAAQ,YAAR;AACAA,QAAQ,iBAAR;;AAEA;AACA;;;AAGAH,SAASC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAM;AAClDJ,UAAQC,GAAR,CAAY,iBAAZ;AACD,CAFD;;;;;;ACZA;;;;;;;;;;;;;;;;AAgBC,WAASH,CAAT,EAAY;;AAEX;AACA,KAAI,CAACH,OAAOK,OAAZ,EAAqBL,OAAOK,OAAP,GAAiB,EAAjB;AACvB,KAAI,CAACL,OAAOK,OAAP,CAAeC,GAApB,EAAyBN,OAAOK,OAAP,CAAeC,GAAf,GAAqB,YAAY,CAAG,CAApC;AACzB;;AAEAH,GAAEmG,EAAF,CAAKjB,gBAAL,GAAyB,YAAW;;AAEnC,MAAIkB,QAAQ,IAAZ;;AAEA;AACA;AACAA,QAAMC,MAAN,GAAe;AACdjB,oBAAkB,iBADJ;AAEdC,kBAAgB,KAFF;AAGdC,eAAa,SAHC;AAIdC,iBAAe,KAJD;AAKdC,eAAa,+BALC;AAMdC,cAAY,wMANE;AAOdC,wBAAsB,UAPR;AAQdC,yBAAuB,iBART;AASdC,mCAAiC,IATnB;AAUdC,2BAAyB,EAVX;AAWdC,2BAAyB,KAXX;AAYdC,eAAa;AAZC,GAAf;;AAeA;AACA;AACAK,QAAME,IAAN,GAAa;AACZC,gBAAc,KADF;AAEZC,gBAAc,IAFF;AAGZC,gBAAc;AAHF,GAAb;;AAMA;AACA;;AAEA;AACC,MAAIC,kBAAkB,SAAlBA,eAAkB,CAASC,MAAT,EAAiBC,MAAjB,EAAyBC,QAAzB,EAAmC;;AAEzD,OAAIF,MAAJ,EAAY;AACX,QAAIG,YAAY9G,EAAE2G,MAAF,EAAU5D,IAAV,CAAe,OAAf,IAA0B/C,EAAE2G,MAAF,EAAU5D,IAAV,CAAe,OAAf,CAA1B,GAAoD,EAApE;AACA,QAAI+D,UAAUvF,OAAV,CAAkB,aAAlB,IAAmC,CAAC,CAAxC,EAA2C;AAC1C6E,WAAMC,MAAN,CAAahB,aAAb,GAA6B,KAA7B;AACA,KAFD,MAGK,IAAIyB,UAAUvF,OAAV,CAAkB,kBAAlB,IAAwC,CAAC,CAA7C,EAAgD;AACpD6E,WAAMC,MAAN,CAAahB,aAAb,GAA6B,UAA7B;AACA,KAFI,MAGA,IAAIyB,UAAUvF,OAAV,CAAkB,qBAAlB,IAA2C,CAAC,CAAhD,EAAmD;AACvD6E,WAAMC,MAAN,CAAahB,aAAb,GAA6B,aAA7B;AACA,KAFI,MAGA,IAAIyB,UAAUvF,OAAV,CAAkB,oBAAlB,IAA0C,CAAC,CAA/C,EAAkD;AACtD6E,WAAMC,MAAN,CAAahB,aAAb,GAA6B,YAA7B;AACA,KAFI,MAGA,IAAIyB,UAAUvF,OAAV,CAAkB,gBAAlB,IAAsC,CAAC,CAA3C,EAA8C;AAClD6E,WAAMC,MAAN,CAAahB,aAAb,GAA6B,QAA7B;AACA,KAFI,MAGA,IAAIyB,UAAUvF,OAAV,CAAkB,eAAlB,IAAqC,CAAC,CAA1C,EAA6C;AACjD6E,WAAMC,MAAN,CAAahB,aAAb,GAA6B,OAA7B;AACA;AACD,QAAIyB,UAAUvF,OAAV,CAAkB,uBAAlB,IAA6C,CAAC,CAAlD,EAAqD;AACpD6E,WAAMC,MAAN,CAAaf,UAAb,GAA0B,SAA1B;AACA,KAFD,MAGK,IAAIwB,UAAUvF,OAAV,CAAkB,uBAAlB,IAA6C,CAAC,CAAlD,EAAqD;AACzD6E,WAAMC,MAAN,CAAaf,UAAb,GAA0B,SAA1B;AACA;AACD,QAAIwB,UAAUvF,OAAV,CAAkB,uBAAlB,IAA6C,CAAC,CAAlD,EAAqD;AACpD6E,WAAMC,MAAN,CAAad,YAAb,GAA4B,IAA5B;AACA;AACD;;AAED,OAAIqB,MAAJ,EAAY;AACXR,UAAMC,MAAN,CAAaN,UAAb,GAA0Ba,MAA1B;AACA;;AAED,OAAIC,QAAJ,EAAc;AACb,QAAI,OAAOA,SAASzB,eAAhB,KAAoC,WAAxC,EAAqD;AACpDgB,WAAMC,MAAN,CAAajB,eAAb,GAA+ByB,SAASzB,eAAxC;AACA;AACD,QAAI,OAAOyB,SAASxB,aAAhB,KAAkC,WAAtC,EAAmD;AAClDe,WAAMC,MAAN,CAAahB,aAAb,GAA6BwB,SAASxB,aAAtC;AACA;AACD,QAAI,OAAOwB,SAASvB,UAAhB,KAA+B,WAAnC,EAAgD;AAC/Cc,WAAMC,MAAN,CAAaf,UAAb,GAA0BuB,SAASvB,UAAnC;AACA;AACD,QAAI,OAAOuB,SAASrB,UAAhB,KAA+B,WAAnC,EAAgD;AAC/CY,WAAMC,MAAN,CAAab,UAAb,GAA0BqB,SAASrB,UAAnC;AACA;AACD,QAAI,OAAOqB,SAASpB,SAAhB,KAA8B,WAAlC,EAA+C;AAC9CW,WAAMC,MAAN,CAAaZ,SAAb,GAAyBoB,SAASpB,SAAlC;AACA;AACD,QAAI,OAAOoB,SAASnB,mBAAhB,KAAwC,WAA5C,EAAyD;AACxDU,WAAMC,MAAN,CAAaX,mBAAb,GAAmCmB,SAASnB,mBAA5C;AACA;AACD,QAAI,OAAOmB,SAASlB,oBAAhB,KAAyC,WAA7C,EAA0D;AACzDS,WAAMC,MAAN,CAAaV,oBAAb,GAAoCkB,SAASlB,oBAA7C;AACA;AACD,QAAI,OAAOkB,SAASjB,8BAAhB,KAAmD,WAAvD,EAAoE;AACnEQ,WAAMC,MAAN,CAAaT,8BAAb,GAA8CiB,SAASjB,8BAAvD;AACA;AACD,QAAI,OAAOiB,SAAShB,sBAAhB,KAA2C,WAA/C,EAA4D;AAC3DO,WAAMC,MAAN,CAAaR,sBAAb,GAAsCgB,SAAShB,sBAA/C;AACA;AACD,QAAI,OAAOgB,SAASf,sBAAhB,KAA2C,WAA/C,EAA4D;AAC3DM,WAAMC,MAAN,CAAaP,sBAAb,GAAsCe,SAASf,sBAA/C;AACA;AACD,QAAI,OAAOe,SAASd,UAAhB,KAA+B,WAAnC,EAAgD;AAC/CK,WAAMC,MAAN,CAAaN,UAAb,GAA0Bc,SAASd,UAAnC;AACA;AACD;AAED,GAzEA;;AA2ED,MAAIgB,mBAAmB,SAAnBA,gBAAmB,GAAW;;AAEjC,OAAIX,MAAMC,MAAN,CAAaN,UAAjB,EAA6B;AAC5B,WAAOK,MAAMC,MAAN,CAAaN,UAApB;AACA;;AAED,OAAId,OACH,kCACI,qBADJ,GAC4BmB,MAAMC,MAAN,CAAahB,aADzC,IAEKe,MAAMC,MAAN,CAAad,YAAb,GAA4B,wBAA5B,GAAuD,EAF5D,IAGC,iBAHD,GAGqBa,MAAMC,MAAN,CAAaf,UAHlC,GAG+C,IAH/C,GAIC,4BAJD,GAIgCc,MAAMC,MAAN,CAAab,UAJ7C,GAI0D,QAJ1D,GAKC,4BALD,GAKgCY,MAAMC,MAAN,CAAaZ,SAL7C,GAKyD,QALzD,GAMC,+BAND,GAOG,sDAPH,GAO4DW,MAAMC,MAAN,CAAaX,mBAPzE,GAO+F,MAP/F,GAQG,WARH,GAQiBU,MAAMC,MAAN,CAAajB,eAR9B,GAQgD,GARhD,IASIgB,MAAMC,MAAN,CAAaT,8BAAb,GAA8C,iBAA9C,GAAkE,EATtE,IAUE,2CAVF,GAUgDQ,MAAMC,MAAN,CAAaV,oBAV7D,GAUoF,MAVpF,GAWG,8BAXH,GAYC,QAZD,GAaC,+CAbD,GAcA,QAfD;;AAiBA,UAAOV,IAAP;AACA,GAxBD;;AA0BA;AACA,MAAI+B,wBAAwB,SAAxBA,qBAAwB,CAASC,OAAT,EAAkB;AAC7C,OAAIC,IAAI,IAAIC,IAAJ,EAAR;AACA,OAAIC,gBAAgBhB,MAAMC,MAAN,CAAaR,sBAAb,GAAsC,EAAtC,GAA2C,EAA3C,GAAgD,EAAhD,GAAqD,IAAzE;AACAqB,KAAEG,OAAF,CAAWH,EAAEI,OAAF,KAAcF,aAAzB;AACA,OAAIjF,UAAU,aAAa+E,EAAEK,WAAF,EAA3B;AACAlH,YAASmH,MAAT,GAAkBpB,MAAME,IAAN,CAAWG,WAAX,GAAyB,GAAzB,GAA+BQ,OAA/B,GAAyC,IAAzC,GAAgD9E,OAAhD,GAA0D,SAA5E;;AAEAnC,KAAEK,QAAF,EAAYoH,OAAZ,CAAoB,6BAApB,EAAmD,EAAC,WAAYR,OAAb,EAAnD;AACA,GARD;;AAUA;AACA,MAAIS,6BAA6B,SAA7BA,0BAA6B,GAAW;AAC3C,OAAIC,sBAAsB,KAA1B;AACA,OAAIC,UAAUvH,SAASmH,MAAT,CAAgBvE,KAAhB,CAAsB,GAAtB,CAAd;AACA,QAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIuE,QAAQ3H,MAA5B,EAAoCoD,GAApC,EAAyC;AACxC,QAAIwE,IAAID,QAAQvE,CAAR,EAAWyE,IAAX,EAAR;AACA,QAAID,EAAEtG,OAAF,CAAU6E,MAAME,IAAN,CAAWG,WAArB,KAAqC,CAAzC,EAA4C;AAC3CkB,2BAAsBE,EAAE7C,SAAF,CAAYoB,MAAME,IAAN,CAAWG,WAAX,CAAuBxG,MAAvB,GAAgC,CAA5C,EAA+C4H,EAAE5H,MAAjD,CAAtB;AACA;AACD;;AAED,UAAO0H,mBAAP;AACA,GAXD;;AAaA,MAAII,gBAAgB,SAAhBA,aAAgB,GAAW;AAC9B;AACA/H,KAAE,oBAAF,EAAwBgI,OAAxB,CAAgC;AAC/BC,aAAS,CADsB;AAE/BC,YAAQ;AAFuB,IAAhC,EAGG,GAHH,EAGQ,YAAW;AAClBlI,MAAE,oBAAF,EAAwBmI,IAAxB,CAA6B,CAA7B;AACA,IALD;AAMA,GARD;;AAUA;AACA;AACA,MAAIC,aAAa;;AAEhB;AACAjD,SAAO,cAAS0B,QAAT,EAAmB;;AAEzBH,oBACC1G,EAAE,UAAF,EAAcqI,KAAd,EADD,EAECrI,EAAE,iBAAF,EAAqBiF,IAArB,EAFD,EAGC4B,QAHD;;AAKA;AACA,QAAIa,4BAAJ,EAAkC;AAC7B1H,OAAEK,QAAF,EAAYoH,OAAZ,CAAoB,8BAApB,EAAoD,EAAC,WAAW,IAAZ,EAApD;AACJ;AACA;;AAED;AACA,QAAIrB,MAAME,IAAN,CAAWC,WAAf,EAA4B;AAC3B;AACA;AACDH,UAAME,IAAN,CAAWC,WAAX,GAAyB,IAAzB;;AAEA;AACAH,UAAME,IAAN,CAAWE,WAAX,GAAyBO,kBAAzB;;AAEA,QAAI/G,EAAE,gBAAF,EAAoBC,MAApB,GAA6B,CAAjC,EAAoC;AACnCD,OAAE,gBAAF,EAAoBsI,MAApB,CAA2BlC,MAAME,IAAN,CAAWE,WAAtC;AACA,KAFD,MAEO;AACNxG,OAAE,MAAF,EAAUsI,MAAV,CAAiBlC,MAAME,IAAN,CAAWE,WAA5B;AACA;;AAEoBxG,MAAE,mBAAF,EAAuBuI,EAAvB,CAA0B,OAA1B,EAAmC,YAAW;AAClEvB,2BAAsB,IAAtB;AACAe;AACA,YAAO,KAAP;AACA,KAJoB;AAKA/H,MAAE,sBAAF,EAA0BuI,EAA1B,CAA6B,OAA7B,EAAsC,YAAW;AACrEvB,2BAAsB,IAAtB;AACAe;AACA,YAAO,KAAP;AACA,KAJoB;AAKrB;;AAEA;AACA/H,MAAE,oBAAF,EAAwBwI,IAAxB;;AAEA;AACA,QAAIpC,MAAMC,MAAN,CAAaP,sBAAjB,EAAyC;AACxCkB,2BAAsB,IAAtB;AACA;AAED;;AAnDe,GAAjB;;AAuDA,SAAOoB,UAAP;AACA,EAnOD;;AAqOApI,GAAEK,QAAF,EAAYoI,KAAZ,CAAmB,YAAW;AAC7B,MAAIzI,EAAE,UAAF,EAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC7BD,KAAEK,QAAF,EAAY6E,gBAAZ,GAA+BC,IAA/B,CAAoC;AACnC,YAAS,gCAD0B;AAEnC,kBAAe,iCAFoB;AAGnC,iBAAc;AAHqB,IAApC;AAKA;AACD,EARD;;AAUAnF,GAAEK,QAAF,EAAYkI,EAAZ,CAAe,6BAAf,EAA8C,UAASG,KAAT,EAAgB/B,MAAhB,EAAwB;AACrEzG,UAAQC,GAAR,CAAY,kCAAkCH,EAAE2G,MAAF,EAAU5D,IAAV,CAAe,SAAf,CAA9C;AACA,EAFD;AAIC,CA1PA,EA0PCkB,MA1PD,CAAD;;;;;;;;AChBA;;;;;;;;;;;;;AAaA,CAAC,UAAUjE,CAAV,EAAa;;AAEVA,MAAEkE,IAAF,GAAS,EAAT;;AAEA;;;;AAIAlE,MAAEkE,IAAF,CAAOyE,GAAP,GAAa,EAAb;;AAEA,QAAIpE,QAAQ,SAARA,KAAQ,CAAUqE,OAAV,EAAmB;AAC3B/I,eAAOK,OAAP,IAAkBA,QAAQC,GAAR,CAAY,WAAWyI,OAAvB,CAAlB;AACH,KAFD;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA5I,MAAEkE,IAAF,CAAOE,UAAP,GAAoB,UAAUyC,QAAV,EAAoB;;AAEpC,YAAIgC,WAAW;AACXxE,kBAAM,UADK;AAEXrD,sBAAU,EAFC;AAGXoB,kBAAM,EAHK;AAIX0G,uBAAW,IAJA;AAKXxE,kBAAM,MALK;AAMXG,mBAAO,KANI;AAOXF,mBAAO,KAPI;AAQXC,sBAAU,OARC;AASXE,mBAAO,KATI;AAUXC,sBAAU;AAVC,SAAf;;AAaAkC,mBAAW7G,EAAE+I,MAAF,CAASF,QAAT,EAAmBhC,QAAnB,CAAX;;AAEA,YAAIA,SAASiC,SAAT,IAAsB,OAAOjC,SAASiC,SAAhB,IAA6B,QAAvD,EAAiE;AAC7D;AACA,gBAAIjC,SAASiC,SAAT,CAAmBzH,KAAnB,CAAyB,UAAzB,CAAJ,EAA0C;AACtCrB,kBAAEkE,IAAF,CAAOyE,GAAP,CAAW9B,SAASiC,SAApB,IAAiC,EAAjC;AACH,aAFD,MAEO;AACHvE,sBAAM,kDAAN;AACAsC,yBAASiC,SAAT,GAAqB,IAArB;AACH;AACJ;;AAED;AACA,YAAI,CAACjC,SAASzE,IAAT,CAAcf,KAAd,CAAoB,KAApB,CAAL,EAAiCwF,SAASzE,IAAT,IAAiB,GAAjB;;AAEjC;AACAyE,iBAAS7F,QAAT,GAAoBhB,EAAEkE,IAAF,CAAO8E,qBAAP,CAA6BnC,QAA7B,CAApB;;AAEA;AACA,YAAIoC,QAASpC,SAASxC,IAAT,IAAiBwC,SAASxC,IAAT,CAAc6E,WAAd,KAA8BC,KAAhD,GAAyDtC,SAASxC,IAAlE,GAAyE,CAACwC,SAASxC,IAAV,CAArF;;AAEA;AACA;AACAwC,iBAASuC,UAAT,GAAuBH,MAAMhJ,MAAN,GAAe,CAAhB,IAAuB4G,SAAS7F,QAAT,CAAkBf,MAAlB,IAA4B,CAA7B,GAAkCgJ,MAAMhJ,MAAxC,GAAiD,CAAvE,CAAtB;AACA,YAAI4G,SAAStC,KAAb,EAAoB;AAChBA,kBAAM,iBAAiBsC,SAASuC,UAAhC;AACH;;AAEDvC,iBAASwC,WAAT,GAAuB,CAAvB;;AAEAJ,cAAMK,OAAN,CAAc,UAAUC,IAAV,EAAgB;;AAE1B,gBAAIC,eAAJ,EAAqBC,aAArB,EAAoCC,YAApC,EAAkDC,SAAlD;AACA;AACAH,8BAAkB3C,SAASzE,IAAT,GAAgBmH,IAAhB,GAAuB,aAAzC;AACA;AACA,gBAAIK,YAAY/C,SAAS7F,QAAT,CAAkBgE,SAAlB,CAA4B,CAA5B,EAA+B,CAA/B,CAAhB;AACAyE,4BAAgB5C,SAASzE,IAAT,GAAgBmH,IAAhB,GAAuB,GAAvB,GAA6BK,SAA7B,GAAyC,aAAzD;AACA;AACA,gBAAI/C,SAAS7F,QAAT,CAAkBf,MAAlB,IAA4B,CAAhC,EAAmC;AAC/B,oBAAI4J,WAAWhD,SAAS7F,QAAT,CAAkBgE,SAAlB,CAA4B,CAA5B,EAA+B,CAA/B,CAAf;AACA0E,+BAAe7C,SAASzE,IAAT,GAAgBmH,IAAhB,GAAuB,GAAvB,GAA6BM,QAA7B,GAAwC,aAAvD;AACAF,4BAAY,CAACH,eAAD,EAAkBC,aAAlB,EAAiCC,YAAjC,CAAZ;AACH,aAJD,MAIO;AACHC,4BAAY,CAACH,eAAD,EAAkBC,aAAlB,CAAZ;AACH;AACDK,8BAAkBH,SAAlB,EAA6B9C,QAA7B;AACH,SAjBD;;AAmBA;AACA,YAAIA,SAASlC,QAAT,IAAqB,CAACkC,SAASnC,KAAnC,EAA0C;AACtCmC,qBAASlC,QAAT;AACH;AACJ,KApED,CA1CU,CA8GP;;AAEH;;;;AAIA3E,MAAEkE,IAAF,CAAOY,IAAP,GAAc,UAAUiF,GAAV,CAAc,wDAAd,EAAwE;;AAElF,YAAIC,OAAO,GAAGC,KAAH,CAASC,IAAT,CAAcC,SAAd,CAAX;;AAEA,YAAIC,OAAJ,EAAatB,SAAb;AACA,YAAIkB,KAAK/J,MAAL,IAAe,CAAnB,EAAsB;AAClB,gBAAID,EAAEqK,OAAF,CAAUL,KAAK,CAAL,CAAV,CAAJ,EAAwB;AACpB;AACAI,0BAAUJ,KAAK,CAAL,CAAV;AACH,aAHD,MAGO,IAAI,QAAOA,KAAK,CAAL,CAAP,MAAmB,QAAvB,EAAiC;AACpC;AACAlB,4BAAYkB,KAAK,CAAL,EAAQlB,SAApB;AACA,oBAAIwB,eAAeN,KAAK,CAAL,EAAQM,YAA3B;AACAN,qBAAKO,MAAL,CAAY,CAAC,CAAb,EAAgB,CAAhB;AACA,oBAAID,YAAJ,EAAkB;AACdnB,0BAAMqB,SAAN,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2BV,IAA3B,EAAiCM,YAAjC;AACH;AACJ;AACJ;;AAED,YAAIK,QAAS7B,SAAD,GAAc9I,EAAEkE,IAAF,CAAOyE,GAAP,CAAWG,SAAX,EAAsBiB,GAAtB,CAAd,GAA2C/J,EAAEkE,IAAF,CAAOyE,GAAP,CAAWoB,GAAX,CAAvD;AACA,YAAIY,UAAU,IAAd,EAAoB;AAChB,mBAAO,OAAQ7B,SAAD,GAAcA,YAAY,GAAZ,GAAkBiB,GAAhC,GAAsCA,GAA7C,IAAoD,GAA3D;AACH;;AAED;AACA;;;;;;;;;;;;;;;;;;;;;;AAsBA,YAAI1G,CAAJ;AACA,YAAI,OAAOsH,KAAP,IAAiB,QAArB,EAA+B;AAC3B;AACA;AACAtH,gBAAI,CAAJ;AACA,mBAAO,CAACA,IAAIsH,MAAMpJ,OAAN,CAAc,IAAd,EAAoB8B,CAApB,CAAL,KAAgC,CAAC,CAAxC,EAA2C;AACvC,oBAAIsH,MAAMC,MAAN,CAAavH,IAAI,CAAjB,KAAuB,GAA3B,EAAgC;AAC5BsH,4BAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwB,IAAxB,GAA+BsH,MAAM3F,SAAN,CAAiB3B,GAAD,GAAQ,CAAxB,CAAvC,CAD4B,CACuC;AACtE,iBAFD,MAEO,IAAIsH,MAAMC,MAAN,CAAavH,IAAI,CAAjB,KAAuB,GAA3B,EAAgC;AACnCsH,4BAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwB,IAAxB,GAA+BsH,MAAM3F,SAAN,CAAiB3B,GAAD,GAAQ,CAAxB,CAAvC,CADmC,CACgC;AACtE,iBAFM,MAEA,IAAIsH,MAAMC,MAAN,CAAavH,IAAI,CAAjB,KAAuB,GAA3B,EAAgC;AACnCsH,4BAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwB,IAAxB,GAA+BsH,MAAM3F,SAAN,CAAiB3B,GAAD,GAAQ,CAAxB,CAAvC,CADmC,CACgC;AACtE,iBAFM,MAEA,IAAIsH,MAAMC,MAAN,CAAavH,IAAI,CAAjB,KAAuB,GAA3B,EAAgC;AACnCsH,4BAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwB,IAAxB,GAA+BsH,MAAM3F,SAAN,CAAiB3B,GAAD,GAAQ,CAAxB,CAAvC,CADmC,CACgC;AACtE,iBAFM,MAEA,IAAIsH,MAAMC,MAAN,CAAavH,IAAI,CAAjB,KAAuB,IAA3B,EAAiC;AACpCsH,4BAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwB,IAAxB,GAA+BsH,MAAM3F,SAAN,CAAiB3B,GAAD,GAAQ,CAAxB,CAAvC,CADoC,CAC+B;AACtE,iBAFM,MAEA;AACHsH,4BAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwBsH,MAAM3F,SAAN,CAAgB3B,IAAI,CAApB,CAAhC,CADG,CACqD;AAC3D;AACJ;;AAED;AACA,gBAAIwH,MAAM,EAAV;AAAA,gBAAcC,CAAd;AAAA,gBAAiBpH,KAAjB;AACAL,gBAAI,CAAJ;AACA,mBAAOA,IAAIsH,MAAM1K,MAAjB,EAAyB;AACrB,oBAAI0K,MAAMC,MAAN,CAAavH,CAAb,KAAmB,IAAvB,EAA6B;AACzB;AACA,wBAAIA,KAAKsH,MAAM1K,MAAN,GAAe,CAAxB,EAA2B;AACvB0K,gCAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,CAAR,CADuB,CACQ;AAClC,qBAFD,MAEO,IAAIsH,MAAMC,MAAN,CAAavH,IAAI,CAAjB,KAAuB,IAA3B,EAAiC;AACpCsH,gCAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwBsH,MAAM3F,SAAN,CAAgB,EAAE3B,CAAlB,CAAhC,CADoC,CACkB;AACzD,qBAFM,MAEA;AACH;AACAyH,4BAAIzH,IAAI,CAAR;AACA,+BAAO,CAACyH,IAAIH,MAAMpJ,OAAN,CAAc,IAAd,EAAoBuJ,CAApB,CAAL,KAAgC,CAAC,CAAxC,EAA2C;AACvC,gCAAIA,KAAKH,MAAM1K,MAAN,GAAe,CAApB,IAAyB0K,MAAMC,MAAN,CAAaE,IAAI,CAAjB,KAAuB,IAApD,EAA0D;AACtD;AACAH,wCAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwBsH,MAAM3F,SAAN,CAAgB3B,IAAI,CAApB,EAAuByH,CAAvB,CAAxB,GAAoDH,MAAM3F,SAAN,CAAgB8F,IAAI,CAApB,CAA5D;AACAzH,oCAAIyH,IAAI,CAAR;AACA;AACH,6BALD,MAKO;AACH;AACAH,wCAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB8F,CAAnB,IAAwBH,MAAM3F,SAAN,CAAgB,EAAE8F,CAAlB,CAAhC;AACH;AACJ;;AAED,4BAAIA,KAAK,CAAC,CAAV,EAAa;AACT;AACAH,oCAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,IAAwBsH,MAAM3F,SAAN,CAAgB3B,IAAI,CAApB,CAAhC;AACH;AACJ;AACJ,iBA1BD,MA0BO,IAAIsH,MAAMC,MAAN,CAAavH,CAAb,KAAmB,GAAvB,EAA4B;AAC/B;AACAyH,wBAAIH,MAAMpJ,OAAN,CAAc,GAAd,EAAmB8B,IAAI,CAAvB,CAAJ;AACA,wBAAIyH,KAAK,CAAC,CAAV,EAAa;AACTzH,4BADS,CACJ;AACR,qBAFD,MAEO;AACH;AACAK,gCAAQqH,SAASJ,MAAM3F,SAAN,CAAgB3B,IAAI,CAApB,EAAuByH,CAAvB,CAAT,CAAR;AACA,4BAAI,CAACE,MAAMtH,KAAN,CAAD,IAAiBA,SAAS,CAA9B,EAAiC;AAC7B;AACA,gCAAIuH,IAAIN,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB3B,CAAnB,CAAR;AACA,gCAAI4H,MAAM,EAAV,EAAc;AACVJ,oCAAIJ,IAAJ,CAASQ,CAAT;AACH;AACD;AACAJ,gCAAIJ,IAAJ,CAAS/G,KAAT;AACA;AACAL,gCAAI,CAAJ;AACAsH,oCAAQA,MAAM3F,SAAN,CAAgB8F,IAAI,CAApB,CAAR;AACH,yBAXD,MAWO;AACHzH,gCAAIyH,IAAI,CAAR,CADG,CACQ;AACd;AACJ;AACJ,iBAvBM,MAuBA;AACHzH;AACH;AACJ,aA5E0B,CA4EzB;;AAEF;AACA,gBAAIsH,UAAU,EAAd,EAAkB;AACdE,oBAAIJ,IAAJ,CAASE,KAAT;AACH;AACDA,oBAAQE,GAAR;;AAEA;AACA,gBAAI/B,SAAJ,EAAe;AACX9I,kBAAEkE,IAAF,CAAOyE,GAAP,CAAW9B,SAASiC,SAApB,EAA+BiB,GAA/B,IAAsCc,GAAtC;AACH,aAFD,MAEO;AACH7K,kBAAEkE,IAAF,CAAOyE,GAAP,CAAWoB,GAAX,IAAkBc,GAAlB;AACH;AACJ;;AAED,YAAIF,MAAM1K,MAAN,KAAiB,CAArB,EAAwB;AACpB,mBAAO,EAAP;AACH;AACD,YAAI0K,MAAM1K,MAAN,IAAgB,CAAhB,IAAqB,OAAO0K,MAAM,CAAN,CAAP,IAAoB,QAA7C,EAAuD;AACnD,mBAAOA,MAAM,CAAN,CAAP;AACH;;AAED,YAAIlI,MAAM,EAAV;AACA,aAAKY,IAAI,CAAJ,EAAOyH,IAAIH,MAAM1K,MAAtB,EAA8BoD,IAAIyH,CAAlC,EAAqCzH,GAArC,EAA0C;AACtC,gBAAI,OAAOsH,MAAMtH,CAAN,CAAP,IAAoB,QAAxB,EAAkC;AAC9BZ,uBAAOkI,MAAMtH,CAAN,CAAP;AACH,aAFD,MAEO,IAAI+G,WAAWO,MAAMtH,CAAN,IAAW+G,QAAQnK,MAAlC,EAA0C;AAC7C;AACAwC,uBAAO2H,QAAQO,MAAMtH,CAAN,CAAR,CAAP;AACH,aAHM,MAGA,IAAI,CAAC+G,OAAD,IAAYO,MAAMtH,CAAN,IAAW,CAAX,GAAe2G,KAAK/J,MAApC,EAA4C;AAC/CwC,uBAAOuH,KAAKW,MAAMtH,CAAN,IAAW,CAAhB,CAAP;AACH,aAFM,MAEA;AACHZ,uBAAO,MAAMkI,MAAMtH,CAAN,CAAN,GAAiB,GAAxB;AACH;AACJ;;AAED,eAAOZ,GAAP;AACH,KAnKD;;AAqKA,aAASyI,kBAAT,CAA4BrE,QAA5B,EAAsC;;AAElC,YAAIA,SAAStC,KAAb,EAAoB;AAChBA,kBAAM,sBAAN;AACAA,kBAAM,iBAAiBsC,SAASuC,UAAhC;AACA7E,kBAAM,kBAAkBsC,SAASwC,WAAjC;AACH;;AAED,YAAIxC,SAASnC,KAAb,EAAoB;AAChB,gBAAImC,SAASwC,WAAT,KAAyBxC,SAASuC,UAAtC,EAAkD;AAC9C,oBAAIvC,SAASlC,QAAb,EAAuB;AACnBkC,6BAASlC,QAAT;AACH;AACJ;AACJ;AACJ;;AAED,aAASmF,iBAAT,CAA2BH,SAA3B,EAAsC9C,QAAtC,EAAgD;;AAE5C,YAAIA,SAAStC,KAAb,EAAoBA,MAAM,mBAAN;;AAEvB,YAAIoF,cAAc,IAAd,IAAsBA,UAAU1J,MAAV,GAAmB,CAA7C,EAAgD;AAC/CkL,6BAAiBxB,UAAU,CAAV,CAAjB,EAA+B9C,QAA/B,EAAyC,YAAY;AACpD8C,0BAAUyB,KAAV;AACAtB,kCAAkBH,SAAlB,EAA4B9C,QAA5B;AACA,aAHD;AAIA,SALD,MAKO;AACAqE,+BAAmBrE,QAAnB;AACH;AACJ;;AAED;AACA,aAASsE,gBAAT,CAA0BE,QAA1B,EAAoCxE,QAApC,EAA8CyE,QAA9C,EAAwD;;AAEpD,YAAIzE,SAAStC,KAAb,EAAoB;AAChBA,kBAAM,wBAAwB8G,QAAxB,GAAkC,KAAxC;AACA9G,kBAAM,iBAAiBsC,SAASuC,UAAhC;AACA7E,kBAAM,kBAAkBsC,SAASwC,WAAjC;AACH;;AAEF,YAAIgC,aAAa,IAAb,IAAqB,OAAOA,QAAP,KAAoB,WAA7C,EAA0D;AACrDrL,cAAEuL,IAAF,CAAO;AACHpI,qBAAKkI,QADF;AAEH3G,uBAAOmC,SAASnC,KAFb;AAGHD,uBAAOoC,SAASpC,KAHb;AAIH+G,0BAAU,MAJP;AAKHC,yBAAS,iBAAUC,IAAV,EAAgBC,MAAhB,EAAwB;;AAE7B,wBAAI9E,SAAStC,KAAb,EAAoB;AAChBA,8BAAM,8BAA8B8G,QAA9B,GAAyC,GAA/C;AACA9G,8BAAMmH,IAAN;AACH;;AAEDE,8BAAUF,IAAV,EAAgB7E,QAAhB;AACAyE;AACH,iBAdE;AAeHO,uBAAO,eAAUC,KAAV,EAAiBC,UAAjB,EAA6BC,WAA7B,EAA0C;;AAE7C,wBAAInF,SAAStC,KAAb,EAAoB;AAChBA,8BAAM,iCAAiC8G,QAAjC,GAA4C,iBAA5C,GAAgEW,WAAtE;AACH;AACD,wBAAIF,MAAMH,MAAN,KAAiB,GAArB,EAA0B;AACtB9E,iCAASuC,UAAT,IAAuB,CAAvB;AACH;AACDkC;AACH;AAxBE,aAAP;AA0BH;AACJ;;AAED;AACA,aAASM,SAAT,CAAmBF,IAAnB,EAAyB7E,QAAzB,EAAmC;;AAE/B,YAAIoF,SAAS,EAAb;AACA,YAAIC,QAAQR,KAAKzI,KAAL,CAAW,IAAX,CAAZ;AACA,YAAIkJ,iBAAiB,WAArB;AACA,YAAIC,oBAAoB,WAAxB;AACA,YAAIC,YAAY,aAAhB;AACA,aAAK,IAAIhJ,IAAE,CAAN,EAAQyH,IAAEoB,MAAMjM,MAArB,EAA4BoD,IAAEyH,CAA9B,EAAgCzH,GAAhC,EAAqC;AACjC,gBAAIiJ,OAAOJ,MAAM7I,CAAN,CAAX;;AAEAiJ,mBAAOA,KAAKxE,IAAL,EAAP;AACA,gBAAIwE,KAAKrM,MAAL,GAAc,CAAd,IAAmBqM,KAAKjL,KAAL,CAAW,IAAX,KAAoB,GAA3C,EAAgD;AAAE;AAC9C,oBAAIkL,OAAOD,KAAKrJ,KAAL,CAAW,GAAX,CAAX;AACA,oBAAIsJ,KAAKtM,MAAL,GAAc,CAAlB,EAAqB;AACjB;AACA,wBAAIoE,OAAOmI,UAAUD,KAAK,CAAL,CAAV,EAAmBzE,IAAnB,EAAX;AACA,wBAAI6C,QAAQ4B,KAAKtM,MAAL,IAAe,CAAf,GAAmB,EAAnB,GAAwBsM,KAAK,CAAL,CAApC;AACA;AACA,2BAAO5B,MAAMpI,MAAN,CAAa,KAAb,KAAuB,CAAC,CAA/B,EAAkC;AAC9BoI,gCAAQA,MAAM3F,SAAN,CAAgB,CAAhB,EAAmB2F,MAAM1K,MAAN,GAAe,CAAlC,CAAR;AACA0K,iCAASuB,MAAM,EAAE7I,CAAR,EAAWoJ,SAAX,EAAT;AACH;AACD;AACA,yBAAK,IAAIxB,IAAI,CAAb,EAAgBA,IAAIsB,KAAKtM,MAAzB,EAAiCgL,GAAjC,EAAsC;AAClCN,iCAAS,MAAM4B,KAAKtB,CAAL,CAAf;AACH;AACDN,4BAAQA,MAAM7C,IAAN,EAAR;;AAEA;AACA,wBAAIjB,SAASvC,IAAT,IAAiB,KAAjB,IAA0BuC,SAASvC,IAAT,IAAiB,MAA/C,EAAuD;AACnD;AACA,4BAAIoI,iBAAiB/B,MAAMtJ,KAAN,CAAYgL,SAAZ,CAArB;AACA,4BAAIK,cAAJ,EAAoB;AAChBA,2CAAepD,OAAf,CAAuB,UAAUjI,KAAV,EAAiB;AACpCsJ,wCAAQA,MAAMlH,OAAN,CAAcpC,KAAd,EAAqBsL,gBAAgBtL,KAAhB,CAArB,CAAR;AACH,6BAFD;AAGH;AACD;AACA,4BAAIwF,SAASiC,SAAb,EAAwB;AACpB9I,8BAAEkE,IAAF,CAAOyE,GAAP,CAAW9B,SAASiC,SAApB,EAA+BzE,IAA/B,IAAuCsG,KAAvC;AACH,yBAFD,MAEO;AACH3K,8BAAEkE,IAAF,CAAOyE,GAAP,CAAWtE,IAAX,IAAmBsG,KAAnB;AACH;AACJ;;AAED;AACA,wBAAI9D,SAASvC,IAAT,IAAiB,MAAjB,IAA2BuC,SAASvC,IAAT,IAAiB,MAAhD,EAAwD;AACpDqG,gCAAQA,MAAMlH,OAAN,CAAc,IAAd,EAAoB,KAApB,CAAR,CADoD,CAChB;;AAEpC;AACAmJ,0CAAkBvI,IAAlB;;AAEA;AACA,4BAAI8H,eAAevM,IAAf,CAAoB+K,KAApB,CAAJ,EAAgC;AAC5B,gCAAIkC,QAAQlC,MAAM1H,KAAN,CAAYkJ,cAAZ,CAAZ;AACA;AACA,gCAAI9D,QAAQ,IAAZ;AACA,gCAAIyE,SAAS,EAAb;AACA,gCAAIC,WAAW,EAAf;AACAF,kCAAMvD,OAAN,CAAc,UAAU0D,IAAV,EAAgB;;AAE1B,oCAAIb,eAAevM,IAAf,CAAoBoN,IAApB,MAA8BD,SAAS9M,MAAT,KAAoB,CAApB,IAAyB8M,SAASxL,OAAT,CAAiByL,IAAjB,KAA0B,CAAC,CAAlF,CAAJ,EAA0F;AACtF,wCAAI,CAAC3E,KAAL,EAAY;AACRyE,kDAAU,GAAV;AACH;AACDA,8CAAUE,KAAKvJ,OAAL,CAAa2I,iBAAb,EAAgC,KAAhC,CAAV;AACAW,6CAAStC,IAAT,CAAcuC,IAAd;AACA3E,4CAAQ,KAAR;AACH;AACJ,6BAVD;AAWA4D,sCAAU5H,OAAO,YAAP,GAAsByI,MAAtB,GAA+B,IAAzC;AACA;AACA,gCAAIG,SAAS,MAAMtC,MAAMlH,OAAN,CAAc2I,iBAAd,EAAiC,SAAjC,CAAN,GAAoD,GAAjE;AACAH,sCAAU,YAAYgB,MAAZ,GAAqB,GAArB,GAA2B,IAArC;AACA;AACH,yBAtBD,MAsBO;AACHhB,sCAAU5H,OAAO,IAAP,GAAcsG,KAAd,GAAsB,IAAhC;AACH;AACJ,qBAjEgB,CAiEf;AACL,iBApE2C,CAoE1C;AACL,aAzEgC,CAyE/B;AACL;AACDuC,aAAKjB,MAAL;AACApF,iBAASwC,WAAT,IAAwB,CAAxB;AACH;;AAED;AACA;AACA,aAASuD,iBAAT,CAA2B7C,GAA3B,EAAgC;;AAE5B,YAAIoD,SAAS,IAAb;AACA,YAAIA,OAAOvN,IAAP,CAAYmK,GAAZ,CAAJ,EAAsB;AAClB,gBAAIqD,WAAW,EAAf;AACA,gBAAIC,QAAQtD,IAAI9G,KAAJ,CAAU,IAAV,CAAZ;AACA,iBAAK,IAAII,IAAE,CAAN,EAAQyH,IAAEuC,MAAMpN,MAArB,EAA4BoD,IAAEyH,CAA9B,EAAgCzH,GAAhC,EAAqC;AACjC,oBAAIgB,OAAOgJ,MAAMhK,CAAN,CAAX;;AAEA,oBAAIA,IAAI,CAAR,EAAW;AACP+J,gCAAY,GAAZ;AACH;;AAEDA,4BAAY/I,IAAZ;AACA,oBAAI6I,KAAK,YAAYE,QAAZ,GAAuB,iBAA5B,CAAJ,EAAoD;AAChDF,yBAAKE,WAAW,MAAhB;AACH;AACJ;AACJ;AACJ;;AAED;AACApN,MAAEkE,IAAF,CAAO8E,qBAAP,GAA+B,UAAUnC,QAAV,EAAoB;;AAE/C,YAAIrF,OAAOqF,SAAS7F,QAApB;AACA,YAAI,CAACQ,IAAD,IAASA,KAAKvB,MAAL,GAAc,CAA3B,EAA8B;AAC1B,gBAAI4G,SAAStC,KAAb,EAAoBA,MAAM,uDAAN;AACpB/C,mBAAQX,UAAUC,SAAV,IAAuBD,UAAUC,SAAV,CAAoBb,MAApB,GAA6B,CAArD,GAA0DY,UAAUC,SAAV,CAAoB,CAApB,CAA1D,GACwBD,UAAUG,QAAV,IAAsBH,UAAUyM,YAAhC,CAA6C,QAA7C,IAAyD,IADxF;AAEA,gBAAIzG,SAAStC,KAAb,EAAoBA,MAAM,4BAA4B/C,IAAlC;AACvB;;AAEDA,eAAOA,KAAKqC,WAAL,EAAP;AACArC,eAAOA,KAAKiC,OAAL,CAAa,GAAb,EAAiB,GAAjB,CAAP,CAX+C,CAWjB;AAC9B,YAAIjC,KAAKvB,MAAL,GAAc,CAAlB,EAAqB;AACjBuB,mBAAOA,KAAKwD,SAAL,CAAe,CAAf,EAAkB,CAAlB,IAAuBxD,KAAKwD,SAAL,CAAe,CAAf,EAAkBuI,WAAlB,EAA9B;AACH;AACD,eAAO/L,IAAP;AACH,KAhBD;;AAkBA;AACA,aAASmL,eAAT,CAAyBlK,GAAzB,EAA8B;;AAE1B;AACA,YAAI+K,QAAQ,EAAZ;AACA,YAAIC,OAAO1C,SAAStI,IAAIiL,MAAJ,CAAW,CAAX,CAAT,EAAwB,EAAxB,CAAX;AACA,YAAID,QAAQ,CAAR,IAAaA,OAAOE,KAAKC,GAAL,CAAS,CAAT,EAAY,EAAZ,CAAxB,EAAyC;AACrCJ,kBAAM/C,IAAN,CAAWgD,IAAX;AACH;AACD;AACA,eAAOD,MAAMK,MAAN,CAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAAE,mBAAOD,MAAME,OAAOC,YAAP,CAAoBF,GAApB,CAAb;AAAwC,SAA3E,EAA6E,EAA7E,CAAP;AACH;AACJ,CA5eD,EA4eI9J,MA5eJ;;;;;;ACbA;;;;;;AAEA,IAAI,CAACvD,mBAASoB,OAAd,EAAuB;AACrBoM,SAAO/I,IAAP,CAAY,EAAEgJ,KAAKzN,mBAAS0N,SAAhB,EAAZ;AACAvO,SAAOwO,MAAP,GAAgB,YAAY;AAC1BrO,MAAGK,QAAH,EAAcoI,KAAd,CAAoB,YAAW;AAC7B;AACA;AACAzI,QAAEK,QAAF,EAAYiO,SAAZ,CAAsB,UAAS5F,KAAT,EAAgBoD,KAAhB,EAAuByC,YAAvB,EAAqCC,WAArC,EAAkD;AAC7EC,cAAMC,cAAN,CAAqBF,eAAe1C,MAAM6C,UAA1C,EAAsD;AACpDC,iBAAO;AACLC,kBAAMN,aAAaM,IADd;AAEL1L,iBAAKoL,aAAapL,GAFb;AAGLuI,kBAAM6C,aAAa7C,IAHd;AAILC,oBAAQG,MAAMH,MAJT;AAKLE,mBAAO2C,eAAe1C,MAAM6C,UALvB;AAMLG,sBAAUhD,MAAMiD,YAAN,CAAmB/J,SAAnB,CAA6B,CAA7B,EAAgC,GAAhC;AANL;AAD6C,SAAtD;AAUM,OAXD;AAYD,KAfD;AAgBD,GAjBD;AAkBD;;;;;;;;;kBCtBc;AACblD,WAAS,IADI;AAEb;AACAkC,aAAW,uBAHE;AAIboK,aAAW;AAJE,C;;;;;;eCAE5N,QAAQ,aAAR,C;IAAXiB,M,YAAAA,M;;AACN,IAAIf,WAAWF,QAAQ,YAAR,EAAsBG,OAArC;;AAEA,SAASqO,SAAT,GAAoB;;AAElBhP,IAAEiP,OAAF,CAAU,4DAAV,EAAwE,UAAUvD,IAAV,EAAiB;AACvF1L,MAAE,mBAAF,EAAuBiF,IAAvB,CAA4BiK,WAAWxD,KAAKyD,YAAhB,CAA5B,EAA2DpL,QAA3D,CAAoE,cAApE;AACD,GAFD;;AAIA/D,IAAEiP,OAAF,CAAU,4CAAV,EAAwD,UAAUvD,IAAV,EAAiB;AACvE1L,MAAE,uBAAF,EAA2BiF,IAA3B,CAAgCyG,KAAKzL,MAArC,EAA6C8D,QAA7C,CAAsD,cAAtD;AACD,GAFD;;AAIA/D,IAAEiP,OAAF,CAAU,6CAAV,EAAyD,UAAUvD,IAAV,EAAiB;AACxE1L,MAAE,eAAF,EAAmBiF,IAAnB,CAAwByG,KAAKzL,MAA7B,EAAqC8D,QAArC,CAA8C,cAA9C;AACD,GAFD;;AAIA/D,IAAEiP,OAAF,CAAU,gFAAV,EAA4F,UAASvD,IAAT,EAAe;AACzG1L,MAAE,iBAAF,EAAqBiF,IAArB,CAA0BiK,WAAWxD,KAAK,CAAL,EAAQ0D,KAAnB,CAA1B,EAAqDrL,QAArD,CAA8D,cAA9D;AACD,GAFD;AAGD;;AAGD,SAASmL,UAAT,CAAoBG,IAApB,EACA;AACEA,UAAQ,EAAR;AACA,MAAIC,MAAM7N,WAAW,IAAX,GAAkB,GAAlB,GAAuB,GAAjC;AACA,MAAI8N,IAAIF,KAAKpM,KAAL,CAAW,GAAX,CAAR;AACA,MAAIuM,KAAKD,EAAE,CAAF,CAAT;AACA,MAAIE,KAAKF,EAAEtP,MAAF,GAAW,CAAX,GAAe,MAAMsP,EAAE,CAAF,CAArB,GAA4B,EAArC;;AAEA,MAAIG,MAAM,cAAV;AACA,SAAOA,IAAI9P,IAAJ,CAAS4P,EAAT,CAAP,EAAqB;AACnBA,SAAKA,GAAG/L,OAAH,CAAWiM,GAAX,EAAgB,OAAOJ,GAAP,GAAa,IAA7B,CAAL;AACD;AACD,SAAOE,KAAKC,EAAZ;AACD;;AAEDpP,SAASC,gBAAT,CAA0B,kBAA1B,EAA6C,YAAU;AACrD,MAAID,SAASP,QAAT,CAAkBC,IAAlB,KAA2B,eAA3B,IAA8CW,SAASoB,OAA3D,EAAqE;AACnEkN;AACD;AACF,CAJD;;;;;;ACtCA,IAAItO,WAAWF,QAAQ,YAAR,EAAsBG,OAArC;;AAEA,IAAIgP,kBAAkB,SAAlBA,eAAkB,GAAM;AAC1B;;AAEA;AACA;;AAEA,MAAItP,SAASP,QAAT,CAAkBC,IAAlB,KAA2B,eAA3B,IACAM,SAASP,QAAT,CAAkBC,IAAlB,KAA2B,cAD3B,IAEAM,SAASP,QAAT,CAAkBC,IAAlB,KAA2B,kBAF/B,EAGE;AACA,QAAIW,SAASoB,OAAb,EAAsB5B,QAAQC,GAAR,6BAAsCE,SAASP,QAAT,CAAkBC,IAAxD;AACtBC,MAAE,yBAAF,EAA6BwI,IAA7B;AACAxI,MAAE,6BAAF,EAAiCwI,IAAjC;AACAxI,MAAE,+BAAF,EAAmCwI,IAAnC;AACD;AACF,CAfD;;AAiBAxI,EAAE,YAAU;AACV2P;AACD,CAFD","file":"public/js/app.js","sourcesContent":["function addCollectoryDownloadsLegend() {\n  setTimeout(() => {\n  if (/^colecciones.gbif.es/.test(window.location.host)) {\n    if ($('#logs-since-2018').length === 0) {\n      console.log('Adding downloads label to collectory');\n      $('#usage-stats>#usage').after('<div id=\"logs-since-2018\"><label style=\"font-weight: normal; font-size: 12px;\">* Las estad&iacute;sticas de uso comenzaron a registrarse el 1 de noviembre de 2018.</label></div>');\n      // $(\"#usage-stats>#usage\").after('<p id=\"logs-since-2018\" class=\"lastUpdated\">Las estad&iacute;sticas de uso comenzaron a registrarse el 1 de noviembre de 2018.</p>');\n    }\n  }\n}, 4000);\n};\n\ndocument.addEventListener(\"DOMContentLoaded\",function(){\n  addCollectoryDownloadsLegend();\n});\n\n\n// TODO do something with this\n","/* DEPRECATED\nvar link = document.createElement( \"link\" );\nlink.href = \"https://datos.gbif.es/css/font-awesome.min.css\"\nlink.type = \"text/css\";\nlink.rel = \"stylesheet\";\nlink.media = \"screen,print\";\n\ndocument.getElementsByTagName( \"head\" )[0].appendChild( link ); */\n","var Url = require('domurl');\nvar Cookies = require('js-cookie');\nvar gbifesjs = require('./settings').default;\n\n// import \"./navigator-languages-parser.js\";\n// For some reason the import fails so copied here:\n// https://www.npmjs.com/package/navigator-languages-parser\n\nfunction getUsersPreferredLanguages() {\n  if (navigator.languages !== undefined) {\n    return navigator.languages;\n  } else if (navigator.language !== undefined) {\n    return [navigator.language];\n  } else {\n    return undefined;\n  } // create else for final fallback, and also create a test for it\n}\n\nfunction parseLanguages(acceptedLangs, defaultLang = false) {\n  const userPref = getUsersPreferredLanguages();\n  const match = userPref ? userPref.find(lang => acceptedLangs.indexOf(lang) !== -1) : undefined;\n  if (match === undefined && defaultLang !== false ) {\n    return defaultLang;\n  }\n  return match;\n}\n\nvar locale = window.gbiflocale;\n\n// https://github.com/Mikhus/domurl\nvar currentUrl  = new Url;\n\nconst enabledLangs = ['es', 'en', 'ca'];\n\nconsole.log(`Navigator languages locale: ${parseLanguages(enabledLangs, 'es')}`);\n\nfunction i18n_init() {\n  if (gbifesjs.isDevel) console.log(\"i18n init in development!\");\n\n  locale = currentUrl.query.lang;\n\n  if (gbifesjs.isDevel) console.log(`Lang locale: ${locale}`);\n\n  if (typeof locale === 'undefined') {\n    locale = Cookies.get('datos-gbif-es-lang')\n  }\n\n  if (gbifesjs.isDevel) console.log(`Initial locale: ${locale}`);\n\n  if (locale === undefined || locale === null) {\n    locale = parseLanguages(enabledLangs, 'es');\n  }\n\n  if (gbifesjs.isDevel) console.log(`Detect locale: ${locale}`);\n\n  const isValid = (enabledLangs.indexOf(locale) > -1);\n\n  if (!isValid) {\n    locale = 'es';\n    if (gbifesjs.isDevel) console.log(`Setting default locale: ${locale}`);\n  } else {\n    if (gbifesjs.isDevel) console.log(`Setting locale from browser: ${locale}`);\n  }\n\n  if (gbifesjs.isDevel) console.log(`End locale: ${locale}`);\n\n  // localhost\n  Cookies.set('datos-gbif-es-lang', locale, { expires: 365, path: '/'});\n  // try this\n  Cookies.set('datos-gbif-es-lang', locale, { expires: 365, path: '/', domain: '.gbif.es' });\n\n}\n\nif (typeof locale === 'undefined') {\n  if (gbifesjs.isDevel) console.log(`init locale: ${locale}`);\n  i18n_init();\n}\n\nif (typeof Cookies.get('datos-gbif-es-lang-session') === 'undefined' && typeof currentUrl.query.lang === 'undefined') {\n  // Workaround to set grails locale\n  // This will use to do a uniq lang redirect (to force grails to set the lang for the session)\n  var in30Minutes = 1/48;\n  // grails default session lifetime is 30min\n  Cookies.set('datos-gbif-es-lang-session', '/', { expires: in30Minutes });\n  currentUrl.query.lang = locale;\n  document.location.search = currentUrl.query;\n}\n\nexport { locale, enabledLangs };\n","/**\n * Simple function to internationalise menus and sections of the home page.\n */\n\nvar gbifesjs = require('./settings').default;\nrequire('./jquery-eu-cookie-law-popup');\nvar { locale, enabledLangs } = require('./i18n_init');\n\n// IE don't have String.endsWith\n// https://stackoverflow.com/a/2548133/642847\nfunction endsWith(str, suffix) {\n  return str.indexOf(suffix, str.length - suffix.length) !== -1;\n}\n\nfunction i18n_menus() {\n  console.log('Calling i18n_menus');\n  if (gbifesjs.isDevel) console.log(`locale in i18n_menus: ${locale}`);\n\n  // Add lang param to lang links\n  if (locale) {\n    $('.top-nav-menu a, .portal-link').each(function () {\n      const $this = $(this);\n      const _href = $this.attr('href');\n      // Take care of #hash in links\n      const uri = _href.split('#')[0];\n      const hash = _href.split('#')[1];\n      if (typeof hash === 'undefined') {\n        // without hash\n        $this.attr('href', `${_href}?lang=${locale}`);\n      } else {\n        $this.attr('href', `${uri}?lang=${locale}#${hash}`);\n      }\n      if (gbifesjs.isDevel) console.log(`Added lang to href: ${$this.attr('href')}`);\n    });\n  }\n\n  const url = window.location.href;\n\n  if (gbifesjs.isDevel) console.log(`Enabled langs: ${enabledLangs}`);\n\n  // This part is for the lang links\n  for (let i = 0; i < enabledLangs.length; i++) {\n    const curlang = enabledLangs[i];\n    const $link = $(`.${curlang}-locale-link`); // or grab it by tagname etc\n\n    let localeUrl = url;\n\n    if (url.indexOf('lang=') !== -1) {\n      localeUrl = url.replace(/lang=en|lang=es|lang=ca/gi, `lang=${curlang}`);\n    } else if (url.indexOf('?') !== -1) {\n      localeUrl = `${localeUrl}&lang=${curlang}`;\n    } else {\n      const uri = url.split('#')[0];\n      let hash = url.split('#')[1];\n      hash = typeof hash === 'undefined' ? '' : `#${hash}`;\n      localeUrl = `${uri}?lang=${curlang}${hash}`;\n    }\n    $link.attr('href', localeUrl);\n    if (gbifesjs.isDevel) console.log(`Added lang to href: ${$link.attr('href')}`);\n  }\n\n\n  // underscore current locale\n  $('.wpml-ls-statics-shortcode_actions ul li').each(function (index) {\n    const currentItem = $(this).text().replace(/^\\s+|\\s+$/gm, '').toLowerCase();\n    $(this).removeClass('wpml-ls-current-language');\n    if (currentItem === locale) {\n      $(this).addClass('wpml-ls-current-language');\n    }\n  });\n\n  const path = `${gbifesjs.layoutUrl}i18n/`;\n\n  if (gbifesjs.isDevel) console.log(`localePath: ${path}`);\n  if (typeof jQuery.i18n === 'undefined') console.warn('jQuery.i18n not yet loaded');\n\n  // https://github.com/jquery-i18n-properties/jquery-i18n-properties\n  jQuery.i18n.properties({\n    name: 'messages',\n    path: path,\n    mode: 'map',\n    debug: false,\n    encoding: 'UTF-8',\n    cache: false,\n    language: locale,\n    async: true,\n    callback: function() {\n      if (gbifesjs.isDevel) console.log(`i18n callback start`);\n      const keys = [\n        'main_title_label',\n        'menu_portal_part1',\n        'menu_portal_part2',\n        'menu_home',\n        'menu_collections',\n        'menu_datasets',\n        'menu_search',\n        'menu_explore',\n        'menu_regions',\n        'top_menu_dataportal',\n        'footer_menu_about',\n        'footer_menu_biodiversity_data',\n        'footer_menu_collaborations',\n        'footer_menu_resources',\n        'footer_menu_news',\n        'footer_menu_training',\n        'footer_menu_software',\n        'footer_menu_contact',\n        'numbers_occurrences_label',\n        'numbers_datasets_label',\n        'numbers_institutions_label',\n        'numbers_species_label',\n        'lang_link_en',\n        'lang_link_es',\n        'lang_link_cat',\n        'footer_legal_info',\n        'search_input_advanced1',\n        'search_input_advanced2',\n        'sub_menu_collections',\n        'sub_menu_collections_detail',\n        'sub_menu_datasets',\n        'sub_menu_datasets_detail',\n        'sub_menu_explore',\n        'sub_menu_explore_detail',\n        'sub_menu_regions',\n        'sub_menu_regions_detail',\n        'footer_legal_code',\n        'banner_search_input_placeholder',\n        'main_search_input_placeholder',\n        'auth_bar_login',\n        'auth_bar_logout',\n        'auth_bar_signup',\n        'auth_bar_myprofile',\n        'autocompleteHeader_placeholder'\n      ];\n\n      for (let i = 0; i < keys.length; i++) {\n        const trans = jQuery.i18n.prop(keys[i]);\n        if (gbifesjs.isDevel) console.log(`i18n of ${keys[i]}: ${trans}`);\n        if (typeof trans !== 'undefined') {\n          if (endsWith(keys[i], '_placeholder')) {\n            const elementID = keys[i].substring(0, keys[i].length - 12);\n            // verify that this element exists\n            $(`#${elementID}`) && $(`#${elementID}`).attr('placeholder', trans);\n          } else {\n            // verify that this element exists\n            $(`#${keys[i]}`) && $(`#${keys[i]}`).html(trans);\n          }\n        }\n      }\n\n      $(document).euCookieLawPopup().init({\n        cookiePolicyUrl : 'https://www.gbif.es/politica-de-cookies/',\n        popupPosition : 'bottom',\n        colorStyle : 'gbif',\n        compactStyle : true,\n        popupTitle : '',\n        popupText : jQuery.i18n.prop('cookie_message'),\n        buttonContinueTitle : jQuery.i18n.prop('cookie_accept_btn'),\n        buttonLearnmoreTitle :jQuery.i18n.prop('cookie_policy_btn'),\n        buttonLearnmoreOpenInNewWindow : true,\n        agreementExpiresInDays : 30,\n        autoAcceptCookiePolicy : false,\n        htmlMarkup : null\n      });\n    }\n  });\n}\n\n// Warn, with min version fails so we load here\n/* $.getScript('/js/jquery.i18n.properties.min.js', function() {\n *   console.log('$.i18n loaded.');\n * });\n *  */\n$(function() {\n  // wait til gbif.es elements are visible\n  var checkExist = setInterval(function() {\n    if ($('#menu_home').length) {\n      console.log(\"gbif_es_elements loaded\");\n      clearInterval(checkExist);\n      i18n_menus();\n    } else {\n      if (gbifesjs.isDevel) console.log(\"gbif_es_elements not loaded\");\n    }\n  }, 1000);\n});\n","require('./settings.js').default;\nrequire('./i18n_init.js');\nrequire('./top-search.js');\nrequire('./collectory.js');\nrequire('./sentry.js');\nrequire('./stats.js');\nrequire('./i18n_menus.js');\n\n// THIS should be added to testPage:\n// require('./application.js');\n\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('App initialized');\n});\n","/**\r\n *\r\n * JQUERY EU COOKIE LAW POPUPS\r\n * version 1.1.1\r\n *\r\n * Code on Github:\r\n * https://github.com/wimagguc/jquery-eu-cookie-law-popup\r\n *\r\n * To see a live demo, go to:\r\n * http://www.wimagguc.com/2018/05/gdpr-compliance-with-the-jquery-eu-cookie-law-plugin/\r\n *\r\n * by Richard Dancsi\r\n * http://www.wimagguc.com/\r\n *\r\n */\r\n\r\n(function($) {\r\n\r\n  // for ie9 doesn't support debug console >>>\r\n  if (!window.console) window.console = {};\r\nif (!window.console.log) window.console.log = function () { };\r\n// ^^^\r\n\r\n$.fn.euCookieLawPopup = (function() {\r\n\r\n\tvar _self = this;\r\n\r\n\t///////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// PARAMETERS (MODIFY THIS PART) //////////////////////////////////////////////////////////////\r\n\t_self.params = {\r\n\t\tcookiePolicyUrl : '/?cookie-policy',\r\n\t\tpopupPosition : 'top',\r\n\t\tcolorStyle : 'default',\r\n\t\tcompactStyle : false,\r\n\t\tpopupTitle : 'This website is using cookies',\r\n\t\tpopupText : 'We use cookies to ensure that we give you the best experience on our website. If you continue without changing your settings, we\\'ll assume that you are happy to receive all cookies on this website.',\r\n\t\tbuttonContinueTitle : 'Continue',\r\n\t\tbuttonLearnmoreTitle : 'Learn&nbsp;more',\r\n\t\tbuttonLearnmoreOpenInNewWindow : true,\r\n\t\tagreementExpiresInDays : 30,\r\n\t\tautoAcceptCookiePolicy : false,\r\n\t\thtmlMarkup : null\r\n\t};\r\n\r\n\t///////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// VARIABLES USED BY THE FUNCTION (DON'T MODIFY THIS PART) ////////////////////////////////////\r\n\t_self.vars = {\r\n\t\tINITIALISED : false,\r\n\t\tHTML_MARKUP : null,\r\n\t\tCOOKIE_NAME : 'EU_COOKIE_LAW_CONSENT'\r\n\t};\r\n\r\n\t///////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// PRIVATE FUNCTIONS FOR MANIPULATING DATA ////////////////////////////////////////////////////\r\n\r\n\t// Overwrite default parameters if any of those is present\r\n  var parseParameters = function(object, markup, settings) {\r\n\r\n\t\tif (object) {\r\n\t\t\tvar className = $(object).attr('class') ? $(object).attr('class') : '';\r\n\t\t\tif (className.indexOf('eupopup-top') > -1) {\r\n\t\t\t\t_self.params.popupPosition = 'top';\r\n\t\t\t}\r\n\t\t\telse if (className.indexOf('eupopup-fixedtop') > -1) {\r\n\t\t\t\t_self.params.popupPosition = 'fixedtop';\r\n\t\t\t}\r\n\t\t\telse if (className.indexOf('eupopup-bottomright') > -1) {\r\n\t\t\t\t_self.params.popupPosition = 'bottomright';\r\n\t\t\t}\r\n\t\t\telse if (className.indexOf('eupopup-bottomleft') > -1) {\r\n\t\t\t\t_self.params.popupPosition = 'bottomleft';\r\n\t\t\t}\r\n\t\t\telse if (className.indexOf('eupopup-bottom') > -1) {\r\n\t\t\t\t_self.params.popupPosition = 'bottom';\r\n\t\t\t}\r\n\t\t\telse if (className.indexOf('eupopup-block') > -1) {\r\n\t\t\t\t_self.params.popupPosition = 'block';\r\n\t\t\t}\r\n\t\t\tif (className.indexOf('eupopup-color-default') > -1) {\r\n\t\t\t\t_self.params.colorStyle = 'default';\r\n\t\t\t}\r\n\t\t\telse if (className.indexOf('eupopup-color-inverse') > -1) {\r\n\t\t\t\t_self.params.colorStyle = 'inverse';\r\n\t\t\t}\r\n\t\t\tif (className.indexOf('eupopup-style-compact') > -1) {\r\n\t\t\t\t_self.params.compactStyle = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (markup) {\r\n\t\t\t_self.params.htmlMarkup = markup;\r\n\t\t}\r\n\r\n\t\tif (settings) {\r\n\t\t\tif (typeof settings.cookiePolicyUrl !== 'undefined') {\r\n\t\t\t\t_self.params.cookiePolicyUrl = settings.cookiePolicyUrl;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.popupPosition !== 'undefined') {\r\n\t\t\t\t_self.params.popupPosition = settings.popupPosition;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.colorStyle !== 'undefined') {\r\n\t\t\t\t_self.params.colorStyle = settings.colorStyle;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.popupTitle !== 'undefined') {\r\n\t\t\t\t_self.params.popupTitle = settings.popupTitle;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.popupText !== 'undefined') {\r\n\t\t\t\t_self.params.popupText = settings.popupText;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.buttonContinueTitle !== 'undefined') {\r\n\t\t\t\t_self.params.buttonContinueTitle = settings.buttonContinueTitle;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.buttonLearnmoreTitle !== 'undefined') {\r\n\t\t\t\t_self.params.buttonLearnmoreTitle = settings.buttonLearnmoreTitle;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.buttonLearnmoreOpenInNewWindow !== 'undefined') {\r\n\t\t\t\t_self.params.buttonLearnmoreOpenInNewWindow = settings.buttonLearnmoreOpenInNewWindow;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.agreementExpiresInDays !== 'undefined') {\r\n\t\t\t\t_self.params.agreementExpiresInDays = settings.agreementExpiresInDays;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.autoAcceptCookiePolicy !== 'undefined') {\r\n\t\t\t\t_self.params.autoAcceptCookiePolicy = settings.autoAcceptCookiePolicy;\r\n\t\t\t}\r\n\t\t\tif (typeof settings.htmlMarkup !== 'undefined') {\r\n\t\t\t\t_self.params.htmlMarkup = settings.htmlMarkup;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar createHtmlMarkup = function() {\r\n\r\n\t\tif (_self.params.htmlMarkup) {\r\n\t\t\treturn _self.params.htmlMarkup;\r\n\t\t}\r\n\r\n\t\tvar html =\r\n\t\t\t'<div class=\"eupopup-container' +\r\n\t\t\t    ' eupopup-container-' + _self.params.popupPosition +\r\n\t\t\t    (_self.params.compactStyle ? ' eupopup-style-compact' : '') +\r\n\t\t\t\t' eupopup-color-' + _self.params.colorStyle + '\">' +\r\n\t\t\t\t'<div class=\"eupopup-head\">' + _self.params.popupTitle + '</div>' +\r\n\t\t\t\t'<div class=\"eupopup-body\">' + _self.params.popupText + '</div>' +\r\n\t\t\t\t'<div class=\"eupopup-buttons\">' +\r\n\t\t\t\t  '<a href=\"#\" class=\"eupopup-button eupopup-button_1\">' + _self.params.buttonContinueTitle + '</a>' +\r\n\t\t\t\t  '<a href=\"' + _self.params.cookiePolicyUrl + '\"' +\r\n\t\t\t\t \t(_self.params.buttonLearnmoreOpenInNewWindow ? ' target=_blank ' : '') +\r\n\t\t\t\t\t' class=\"eupopup-button eupopup-button_2\">' + _self.params.buttonLearnmoreTitle + '</a>' +\r\n\t\t\t\t  '<div class=\"clearfix\"></div>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t\t'<a href=\"#\" class=\"eupopup-closebutton\">x</a>' +\r\n\t\t\t'</div>';\r\n\r\n\t\treturn html;\r\n\t};\r\n\r\n\t// Storing the consent in a cookie\r\n\tvar setUserAcceptsCookies = function(consent) {\r\n\t\tvar d = new Date();\r\n\t\tvar expiresInDays = _self.params.agreementExpiresInDays * 24 * 60 * 60 * 1000;\r\n\t\td.setTime( d.getTime() + expiresInDays );\r\n\t\tvar expires = \"expires=\" + d.toGMTString();\r\n\t\tdocument.cookie = _self.vars.COOKIE_NAME + '=' + consent + \"; \" + expires + \";path=/\";\r\n\r\n\t\t$(document).trigger(\"user_cookie_consent_changed\", {'consent' : consent});\r\n\t};\r\n\r\n\t// Let's see if we have a consent cookie already\r\n\tvar userAlreadyAcceptedCookies = function() {\r\n\t\tvar userAcceptedCookies = false;\r\n\t\tvar cookies = document.cookie.split(\";\");\r\n\t\tfor (var i = 0; i < cookies.length; i++) {\r\n\t\t\tvar c = cookies[i].trim();\r\n\t\t\tif (c.indexOf(_self.vars.COOKIE_NAME) == 0) {\r\n\t\t\t\tuserAcceptedCookies = c.substring(_self.vars.COOKIE_NAME.length + 1, c.length);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn userAcceptedCookies;\r\n\t};\r\n\r\n\tvar hideContainer = function() {\r\n\t\t// $('.eupopup-container').slideUp(200);\r\n\t\t$('.eupopup-container').animate({\r\n\t\t\topacity: 0,\r\n\t\t\theight: 0\r\n\t\t}, 200, function() {\r\n\t\t\t$('.eupopup-container').hide(0);\r\n\t\t});\r\n\t};\r\n\r\n\t///////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// PUBLIC FUNCTIONS  //////////////////////////////////////////////////////////////////////////\r\n\tvar publicfunc = {\r\n\r\n\t\t// INITIALIZE EU COOKIE LAW POPUP /////////////////////////////////////////////////////////\r\n\t\tinit : function(settings) {\r\n\r\n\t\t\tparseParameters(\r\n\t\t\t\t$(\".eupopup\").first(),\r\n\t\t\t\t$(\".eupopup-markup\").html(),\r\n\t\t\t\tsettings);\r\n\r\n\t\t\t// No need to display this if user already accepted the policy\r\n\t\t\tif (userAlreadyAcceptedCookies()) {\r\n        $(document).trigger(\"user_cookie_already_accepted\", {'consent': true});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// We should initialise only once\r\n\t\t\tif (_self.vars.INITIALISED) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t_self.vars.INITIALISED = true;\r\n\r\n\t\t\t// Markup and event listeners >>>\r\n\t\t\t_self.vars.HTML_MARKUP = createHtmlMarkup();\r\n\r\n\t\t\tif ($('.eupopup-block').length > 0) {\r\n\t\t\t\t$('.eupopup-block').append(_self.vars.HTML_MARKUP);\r\n\t\t\t} else {\r\n\t\t\t\t$('BODY').append(_self.vars.HTML_MARKUP);\r\n\t\t\t}\r\n\r\n                        $('.eupopup-button_1').on('click', function() {\r\n\t\t\t\tsetUserAcceptsCookies(true);\r\n\t\t\t\thideContainer();\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n                        $('.eupopup-closebutton').on('click', function() {\r\n\t\t\t\tsetUserAcceptsCookies(true);\r\n\t\t\t\thideContainer();\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t// ^^^ Markup and event listeners\r\n\r\n\t\t\t// Ready to start!\r\n\t\t\t$('.eupopup-container').show();\r\n\r\n\t\t\t// In case it's alright to just display the message once\r\n\t\t\tif (_self.params.autoAcceptCookiePolicy) {\r\n\t\t\t\tsetUserAcceptsCookies(true);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn publicfunc;\r\n});\r\n\r\n$(document).ready( function() {\r\n\tif ($(\".eupopup\").length > 0) {\r\n\t\t$(document).euCookieLawPopup().init({\r\n\t\t\t'info' : 'YOU_CAN_ADD_MORE_SETTINGS_HERE',\r\n\t\t\t'popupTitle' : 'This website is using cookies. ',\r\n\t\t\t'popupText' : 'We use them to give you the best experience. If you continue using our website, we\\'ll assume that you are happy to receive all cookies on this website.'\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(document).on(\"user_cookie_consent_changed\", function(event, object) {\r\n\tconsole.log(\"User cookie consent changed: \" + $(object).attr('consent') );\r\n});\r\n\r\n}(jQuery));\r\n","/******************************************************************************\n * jquery.i18n.properties\n *\n * Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and\n * MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.\n *\n * @version     1.2.7\n * @url         https://github.com/jquery-i18n-properties/jquery-i18n-properties\n * @inspiration Localisation assistance for jQuery (http://keith-wood.name/localisation.html)\n *              by Keith Wood (kbwood{at}iinet.com.au) June 2007\n *\n *****************************************************************************/\n\n(function ($) {\n\n    $.i18n = {};\n\n    /**\n     * Map holding bundle keys if mode is 'map' or 'both'. Values of this can also be an\n     * Object, in which case the key is a namespace.\n     */\n    $.i18n.map = {};\n\n    var debug = function (message) {\n        window.console && console.log('i18n::' + message);\n    };\n\n    /**\n     * Load and parse message bundle files (.properties),\n     * making bundles keys available as javascript variables.\n     *\n     * i18n files are named <name>.js, or <name>_<language>.js or <name>_<language>_<country>.js\n     * Where:\n     *      The <language> argument is a valid ISO Language Code. These codes are the lower-case,\n     *      two-letter codes as defined by ISO-639. You can find a full list of these codes at a\n     *      number of sites, such as: http://www.loc.gov/standards/iso639-2/englangn.html\n     *      The <country> argument is a valid ISO Country Code. These codes are the upper-case,\n     *      two-letter codes as defined by ISO-3166. You can find a full list of these codes at a\n     *      number of sites, such as: http://www.iso.ch/iso/en/prods-services/iso3166ma/02iso-3166-code-lists/list-en1.html\n     *\n     * Sample usage for a bundles/Messages.properties bundle:\n     * $.i18n.properties({\n     *      name:      'Messages',\n     *      language:  'en_US',\n     *      path:      'bundles'\n     * });\n     * @param  name      (string/string[], optional) names of file to load (eg, 'Messages' or ['Msg1','Msg2']). Defaults to \"Messages\"\n     * @param  language    (string, optional) language/country code (eg, 'en', 'en_US', 'pt_BR'). if not specified, language reported by the browser will be used instead.\n     * @param  path      (string, optional) path of directory that contains file to load\n     * @param  mode      (string, optional) whether bundles keys are available as JavaScript variables/functions or as a map (eg, 'vars' or 'map')\n     * @param  debug     (boolean, optional) whether debug statements are logged at the console\n     * @param  cache        (boolean, optional) whether bundles should be cached by the browser, or forcibly reloaded on each page load. Defaults to false (i.e. forcibly reloaded)\n     * @param  encoding  (string, optional) the encoding to request for bundles. Property file resource bundles are specified to be in ISO-8859-1 format. Defaults to UTF-8 for backward compatibility.\n     * @param  callback     (function, optional) callback function to be called after script is terminated\n     */\n    $.i18n.properties = function (settings) {\n\n        var defaults = {\n            name: 'Messages',\n            language: '',\n            path: '',\n            namespace: null,\n            mode: 'vars',\n            cache: false,\n            debug: false,\n            encoding: 'UTF-8',\n            async: false,\n            callback: null\n        };\n\n        settings = $.extend(defaults, settings);\n\n        if (settings.namespace && typeof settings.namespace == 'string') {\n            // A namespace has been supplied, initialise it.\n            if (settings.namespace.match(/^[a-z]*$/)) {\n                $.i18n.map[settings.namespace] = {};\n            } else {\n                debug('Namespaces can only be lower case letters, a - z');\n                settings.namespace = null;\n            }\n        }\n\n        // Ensure a trailing slash on the path\n        if (!settings.path.match(/\\/$/)) settings.path += '/';\n\n        // Try to ensure that we have at a least a two letter language code\n        settings.language = $.i18n.normaliseLanguageCode(settings);\n\n        // Ensure an array\n        var files = (settings.name && settings.name.constructor === Array) ? settings.name : [settings.name];\n\n        // A locale is at least a language code which means at least two files per name. If\n        // we also have a country code, thats an extra file per name.\n        settings.totalFiles = (files.length * 2) + ((settings.language.length >= 5) ? files.length : 0);\n        if (settings.debug) {\n            debug('totalFiles: ' + settings.totalFiles);\n        }\n\n        settings.filesLoaded = 0;\n\n        files.forEach(function (file) {\n\n            var defaultFileName, shortFileName, longFileName, fileNames;\n            // 1. load base (eg, Messages.properties)\n            defaultFileName = settings.path + file + '.properties';\n            // 2. with language code (eg, Messages_pt.properties)\n            var shortCode = settings.language.substring(0, 2);\n            shortFileName = settings.path + file + '_' + shortCode + '.properties';\n            // 3. with language code and country code (eg, Messages_pt_BR.properties)\n            if (settings.language.length >= 5) {\n                var longCode = settings.language.substring(0, 5);\n                longFileName = settings.path + file + '_' + longCode + '.properties';\n                fileNames = [defaultFileName, shortFileName, longFileName];\n            } else {\n                fileNames = [defaultFileName, shortFileName];\n            }\n            loadAndParseFiles(fileNames, settings);\n        });\n\n        // call callback\n        if (settings.callback && !settings.async) {\n            settings.callback();\n        }\n    }; // properties\n\n    /**\n     * When configured with mode: 'map', allows access to bundle values by specifying its key.\n     * Eg, jQuery.i18n.prop('com.company.bundles.menu_add')\n     */\n    $.i18n.prop = function (key /* Add parameters as function arguments as necessary  */) {\n\n        var args = [].slice.call(arguments);\n\n        var phvList, namespace;\n        if (args.length == 2) {\n            if ($.isArray(args[1])) {\n                // An array was passed as the second parameter, so assume it is the list of place holder values.\n                phvList = args[1];\n            } else if (typeof args[1] === 'object') {\n                // Second argument is an options object {namespace: 'mynamespace', replacements: ['egg', 'nog']}\n                namespace = args[1].namespace;\n                var replacements = args[1].replacements;\n                args.splice(-1, 1);\n                if (replacements) {\n                    Array.prototype.push.apply(args, replacements);\n                }\n            }\n        }\n\n        var value = (namespace) ? $.i18n.map[namespace][key] : $.i18n.map[key];\n        if (value === null) {\n            return '[' + ((namespace) ? namespace + '#' + key : key) + ']';\n        }\n\n        // Place holder replacement\n        /**\n        * Tested with:\n        *   test.t1=asdf ''{0}''\n        *   test.t2=asdf '{0}' '{1}'{1}'zxcv\n        *   test.t3=This is \\\"a quote\" 'a''{0}''s'd{fgh{ij'\n        *   test.t4=\"'''{'0}''\" {0}{a}\n        *   test.t5=\"'''{0}'''\" {1}\n        *   test.t6=a {1} b {0} c\n        *   test.t7=a 'quoted \\\\ s\\ttringy' \\t\\t x\n        *\n        * Produces:\n        *   test.t1, p1 ==> asdf 'p1'\n        *   test.t2, p1 ==> asdf {0} {1}{1}zxcv\n        *   test.t3, p1 ==> This is \"a quote\" a'{0}'sd{fgh{ij\n        *   test.t4, p1 ==> \"'{0}'\" p1{a}\n        *   test.t5, p1 ==> \"'{0}'\" {1}\n        *   test.t6, p1 ==> a {1} b p1 c\n        *   test.t6, p1, p2 ==> a p2 b p1 c\n        *   test.t6, p1, p2, p3 ==> a p2 b p1 c\n        *   test.t7 ==> a quoted \\ s\ttringy \t\t x\n        */\n\n        var i;\n        if (typeof(value) == 'string') {\n            // Handle escape characters. Done separately from the tokenizing loop below because escape characters are\n            // active in quoted strings.\n            i = 0;\n            while ((i = value.indexOf('\\\\', i)) != -1) {\n                if (value.charAt(i + 1) == 't') {\n                    value = value.substring(0, i) + '\\t' + value.substring((i++) + 2); // tab\n                } else if (value.charAt(i + 1) == 'r') {\n                    value = value.substring(0, i) + '\\r' + value.substring((i++) + 2); // return\n                } else if (value.charAt(i + 1) == 'n') {\n                    value = value.substring(0, i) + '\\n' + value.substring((i++) + 2); // line feed\n                } else if (value.charAt(i + 1) == 'f') {\n                    value = value.substring(0, i) + '\\f' + value.substring((i++) + 2); // form feed\n                } else if (value.charAt(i + 1) == '\\\\') {\n                    value = value.substring(0, i) + '\\\\' + value.substring((i++) + 2); // \\\n                } else {\n                    value = value.substring(0, i) + value.substring(i + 1); // Quietly drop the character\n                }\n            }\n\n            // Lazily convert the string to a list of tokens.\n            var arr = [], j, index;\n            i = 0;\n            while (i < value.length) {\n                if (value.charAt(i) == '\\'') {\n                    // Handle quotes\n                    if (i == value.length - 1) {\n                        value = value.substring(0, i); // Silently drop the trailing quote\n                    } else if (value.charAt(i + 1) == '\\'') {\n                        value = value.substring(0, i) + value.substring(++i); // Escaped quote\n                    } else {\n                        // Quoted string\n                        j = i + 2;\n                        while ((j = value.indexOf('\\'', j)) != -1) {\n                            if (j == value.length - 1 || value.charAt(j + 1) != '\\'') {\n                                // Found start and end quotes. Remove them\n                                value = value.substring(0, i) + value.substring(i + 1, j) + value.substring(j + 1);\n                                i = j - 1;\n                                break;\n                            } else {\n                                // Found a double quote, reduce to a single quote.\n                                value = value.substring(0, j) + value.substring(++j);\n                            }\n                        }\n\n                        if (j == -1) {\n                            // There is no end quote. Drop the start quote\n                            value = value.substring(0, i) + value.substring(i + 1);\n                        }\n                    }\n                } else if (value.charAt(i) == '{') {\n                    // Beginning of an unquoted place holder.\n                    j = value.indexOf('}', i + 1);\n                    if (j == -1) {\n                        i++; // No end. Process the rest of the line. Java would throw an exception\n                    } else {\n                        // Add 1 to the index so that it aligns with the function arguments.\n                        index = parseInt(value.substring(i + 1, j));\n                        if (!isNaN(index) && index >= 0) {\n                            // Put the line thus far (if it isn't empty) into the array\n                            var s = value.substring(0, i);\n                            if (s !== \"\") {\n                                arr.push(s);\n                            }\n                            // Put the parameter reference into the array\n                            arr.push(index);\n                            // Start the processing over again starting from the rest of the line.\n                            i = 0;\n                            value = value.substring(j + 1);\n                        } else {\n                            i = j + 1; // Invalid parameter. Leave as is.\n                        }\n                    }\n                } else {\n                    i++;\n                }\n            } // while\n\n            // Put the remainder of the no-empty line into the array.\n            if (value !== \"\") {\n                arr.push(value);\n            }\n            value = arr;\n\n            // Make the array the value for the entry.\n            if (namespace) {\n                $.i18n.map[settings.namespace][key] = arr;\n            } else {\n                $.i18n.map[key] = arr;\n            }\n        }\n\n        if (value.length === 0) {\n            return \"\";\n        }\n        if (value.length == 1 && typeof(value[0]) == \"string\") {\n            return value[0];\n        }\n\n        var str = \"\";\n        for (i = 0, j = value.length; i < j; i++) {\n            if (typeof(value[i]) == \"string\") {\n                str += value[i];\n            } else if (phvList && value[i] < phvList.length) {\n                // Must be a number\n                str += phvList[value[i]];\n            } else if (!phvList && value[i] + 1 < args.length) {\n                str += args[value[i] + 1];\n            } else {\n                str += \"{\" + value[i] + \"}\";\n            }\n        }\n\n        return str;\n    };\n\n    function callbackIfComplete(settings) {\n\n        if (settings.debug) {\n            debug('callbackIfComplete()');\n            debug('totalFiles: ' + settings.totalFiles);\n            debug('filesLoaded: ' + settings.filesLoaded);\n        }\n\n        if (settings.async) {\n            if (settings.filesLoaded === settings.totalFiles) {\n                if (settings.callback) {\n                    settings.callback();\n                }\n            }\n        }\n    }\n\n    function loadAndParseFiles(fileNames, settings) {\n\n        if (settings.debug) debug('loadAndParseFiles');\n\n\t    if (fileNames !== null && fileNames.length > 0) {\n\t\t    loadAndParseFile(fileNames[0], settings, function () {\n\t\t\t    fileNames.shift();\n\t\t\t    loadAndParseFiles(fileNames,settings);\n\t\t    });\n\t    } else {\n            callbackIfComplete(settings);\n        }\n    }\n\n    /** Load and parse .properties files */\n    function loadAndParseFile(filename, settings, nextFile) {\n\n        if (settings.debug) {\n            debug('loadAndParseFile(\\'' + filename +'\\')');\n            debug('totalFiles: ' + settings.totalFiles);\n            debug('filesLoaded: ' + settings.filesLoaded);\n        }\n\n  \t    if (filename !== null && typeof filename !== 'undefined') {\n            $.ajax({\n                url: filename,\n                async: settings.async,\n                cache: settings.cache,\n                dataType: 'text',\n                success: function (data, status) {\n\n                    if (settings.debug) {\n                        debug('Succeeded in downloading ' + filename + '.');\n                        debug(data);\n                    }\n\n                    parseData(data, settings);\n                    nextFile();\n                },\n                error: function (jqXHR, textStatus, errorThrown) {\n\n                    if (settings.debug) {\n                        debug('Failed to download or parse ' + filename + '. errorThrown: ' + errorThrown);\n                    }\n                    if (jqXHR.status === 404) {\n                        settings.totalFiles -= 1;\n                    }\n                    nextFile();\n                }\n            });\n        }\n    }\n\n    /** Parse .properties files */\n    function parseData(data, settings) {\n\n        var parsed = '';\n        var lines = data.split(/\\n/);\n        var regPlaceHolder = /(\\{\\d+})/g;\n        var regRepPlaceHolder = /\\{(\\d+)}/g;\n        var unicodeRE = /(\\\\u.{4})/ig;\n        for (var i=0,j=lines.length;i<j;i++) {\n            var line = lines[i];\n\n            line = line.trim();\n            if (line.length > 0 && line.match(\"^#\") != \"#\") { // skip comments\n                var pair = line.split('=');\n                if (pair.length > 0) {\n                    /** Process key & value */\n                    var name = decodeURI(pair[0]).trim();\n                    var value = pair.length == 1 ? \"\" : pair[1];\n                    // process multi-line values\n                    while (value.search(/\\\\$/) != -1) {\n                        value = value.substring(0, value.length - 1);\n                        value += lines[++i].trimRight();\n                    }\n                    // Put values with embedded '='s back together\n                    for (var s = 2; s < pair.length; s++) {\n                        value += '=' + pair[s];\n                    }\n                    value = value.trim();\n\n                    /** Mode: bundle keys in a map */\n                    if (settings.mode == 'map' || settings.mode == 'both') {\n                        // handle unicode chars possibly left out\n                        var unicodeMatches = value.match(unicodeRE);\n                        if (unicodeMatches) {\n                            unicodeMatches.forEach(function (match) {\n                                value = value.replace(match, unescapeUnicode(match));\n                            });\n                        }\n                        // add to map\n                        if (settings.namespace) {\n                            $.i18n.map[settings.namespace][name] = value;\n                        } else {\n                            $.i18n.map[name] = value;\n                        }\n                    }\n\n                    /** Mode: bundle keys as vars/functions */\n                    if (settings.mode == 'vars' || settings.mode == 'both') {\n                        value = value.replace(/\"/g, '\\\\\"'); // escape quotation mark (\")\n\n                        // make sure namespaced key exists (eg, 'some.key')\n                        checkKeyNamespace(name);\n\n                        // value with variable substitutions\n                        if (regPlaceHolder.test(value)) {\n                            var parts = value.split(regPlaceHolder);\n                            // process function args\n                            var first = true;\n                            var fnArgs = '';\n                            var usedArgs = [];\n                            parts.forEach(function (part) {\n\n                                if (regPlaceHolder.test(part) && (usedArgs.length === 0 || usedArgs.indexOf(part) == -1)) {\n                                    if (!first) {\n                                        fnArgs += ',';\n                                    }\n                                    fnArgs += part.replace(regRepPlaceHolder, 'v$1');\n                                    usedArgs.push(part);\n                                    first = false;\n                                }\n                            });\n                            parsed += name + '=function(' + fnArgs + '){';\n                            // process function body\n                            var fnExpr = '\"' + value.replace(regRepPlaceHolder, '\"+v$1+\"') + '\"';\n                            parsed += 'return ' + fnExpr + ';' + '};';\n                            // simple value\n                        } else {\n                            parsed += name + '=\"' + value + '\";';\n                        }\n                    } // END: Mode: bundle keys as vars/functions\n                } // END: if(pair.length > 0)\n            } // END: skip comments\n        }\n        eval(parsed);\n        settings.filesLoaded += 1;\n    }\n\n    /** Make sure namespace exists (for keys with dots in name) */\n    // TODO key parts that start with numbers quietly fail. i.e. month.short.1=Jan\n    function checkKeyNamespace(key) {\n\n        var regDot = /\\./;\n        if (regDot.test(key)) {\n            var fullname = '';\n            var names = key.split(/\\./);\n            for (var i=0,j=names.length;i<j;i++) {\n                var name = names[i];\n\n                if (i > 0) {\n                    fullname += '.';\n                }\n\n                fullname += name;\n                if (eval('typeof ' + fullname + ' == \"undefined\"')) {\n                    eval(fullname + '={};');\n                }\n            }\n        }\n    }\n\n    /** Ensure language code is in the format aa_AA. */\n    $.i18n.normaliseLanguageCode = function (settings) {\n\n        var lang = settings.language;\n        if (!lang || lang.length < 2) {\n            if (settings.debug) debug('No language supplied. Pulling it from the browser ...');\n            lang = (navigator.languages && navigator.languages.length > 0) ? navigator.languages[0]\n                                        : (navigator.language || navigator.userLanguage /* IE */ || 'en');\n            if (settings.debug) debug('Language from browser: ' + lang);\n        }\n\n        lang = lang.toLowerCase();\n        lang = lang.replace(/-/,\"_\"); // some browsers report language as en-US instead of en_US\n        if (lang.length > 3) {\n            lang = lang.substring(0, 3) + lang.substring(3).toUpperCase();\n        }\n        return lang;\n    };\n\n    /** Unescape unicode chars ('\\u00e3') */\n    function unescapeUnicode(str) {\n\n        // unescape unicode codes\n        var codes = [];\n        var code = parseInt(str.substr(2), 16);\n        if (code >= 0 && code < Math.pow(2, 16)) {\n            codes.push(code);\n        }\n        // convert codes to text\n        return codes.reduce(function (acc, val) { return acc + String.fromCharCode(val); }, '');\n    }\n}) (jQuery);\n","import gbifesjs from './settings.js';\n\nif (!gbifesjs.isDevel) {\n  Sentry.init({ dsn: gbifesjs.sentryUrl });\n  window.onload = function () {\n    $( document ).ready(function() {\n      // https://stackoverflow.com/questions/35722717/use-sentrys-raven-js-to-collect-all-http-errors\n      // https://docs.sentry.io/clients/javascript/tips/#jquery-ajax-error-reporting\n      $(document).ajaxError(function(event, jqXHR, ajaxSettings, thrownError) {\n\tRaven.captureMessage(thrownError || jqXHR.statusText, {\n\t  extra: {\n\t    type: ajaxSettings.type,\n\t    url: ajaxSettings.url,\n\t    data: ajaxSettings.data,\n\t    status: jqXHR.status,\n\t    error: thrownError || jqXHR.statusText,\n\t    response: jqXHR.responseText.substring(0, 100)\n\t  }\n\t});\n      });\n    });\n  }\n}\n","export default {\n  isDevel: true,\n  // FIXME remove this\n  layoutUrl: \"https://demo.gbif.es/\",\n  sentryUrl: \"https://e8b7082a5d2f4d659690e56438f6015c@sentry.comunes.org/17\"\n}\n","var { locale } = require('./i18n_init');\nvar gbifesjs = require('./settings').default;\n\nfunction loadStats(){\n\n  $.getJSON(\"https://registros-ws.gbif.es/occurrences/search?pageSize=0\", function( data ) {\n    $('#number_registros').html(addPeriods(data.totalRecords)).addClass('loaded_stats');\n  });\n\n  $.getJSON(\"https://colecciones.gbif.es/ws/institution\", function( data ) {\n    $('#number_instituciones').html(data.length).addClass('loaded_stats');\n  });\n\n  $.getJSON(\"https://colecciones.gbif.es/ws/dataResource\", function( data ) {\n    $('#number_bases').html(data.length).addClass('loaded_stats');\n  });\n\n  $.getJSON(\"https://registros-ws.gbif.es/occurrence/facets?q=*:*&facets=species&pageSize=0\", function(data) {\n    $(\"#number_species\").html(addPeriods(data[0].count)).addClass('loaded_stats');\n  });\n}\n\n\nfunction addPeriods(nStr)\n{\n  nStr += '';\n  var sep = locale === 'en' ? ',': '.';\n  var x = nStr.split('.');\n  var x1 = x[0];\n  var x2 = x.length > 1 ? '.' + x[1] : '';\n\n  var rgx = /(\\d+)(\\d{3})/;\n  while (rgx.test(x1)) {\n    x1 = x1.replace(rgx, '$1' + sep + '$2');\n  }\n  return x1 + x2;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\",function(){\n  if (document.location.host === 'datos.gbif.es' || gbifesjs.isDevel ) {\n    loadStats();\n  }\n});\n","var gbifesjs = require('./settings').default;\n\nvar enableBieSearch = () => {\n  // if (document.location.host !== 'localhost:3002') {\n\n  // Maybe better:\n  // if (/^datos.gbif.es/.test(window.location.host)) {\n\n  if (document.location.host !== 'datos.gbif.es' &&\n      document.location.host !== 'auth.gbif.es' &&\n      document.location.host !== 'especies.gbif.es'\n  ) {\n    if (gbifesjs.isDevel) console.log(`Enabling BIE search in ${document.location.host}`);\n    $(\"#top-search-icon-button\").show();\n    $(\"#top-search-icon-button-big\").show();\n    $(\"#top-search-icon-button-small\").show();\n  }\n}\n\n$(function(){\n  enableBieSearch();\n});\n"]}